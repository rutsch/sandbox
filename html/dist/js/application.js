function reloadApp(){location.reload()}function getEl(e){return document.getElementById(e)||document.getElementsByClassName(e)[0]||document.getElementsByTagName(e)[0]||null}function findPos(e){var t=0,a=0;if(e.offsetParent)do t+=e.offsetLeft,a+=e.offsetTop;while(e=e.offsetParent);return[t,a]}function logAction(e,t,a){}function lon2x(e){var t=2.752,a=473.75,o=e*t+a;return o}function lat2y(e){var t=-2.753,a=231,o=e*t+a;return o}function plot(e,t,a){return a=.5*a+4,R.circle(lon2x(t),lat2y(e),a).attr(city_attr)}function collectionHas(e,t){for(var a=0,o=e.length;a<o;a++)if(e[a]===t)return!0;return!1}function ColorLuminance(e,t){var e=String(e).replace(/[^0-9a-f]/gi,"");e.length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),t=t||0;var a,o,n="#";for(o=0;o<3;o++)a=parseInt(e.substr(2*o,2),16),a=Math.round(Math.min(Math.max(0,a+a*t),255)).toString(16),n+=("00"+a).substr(a.length);return n}function getFirstLevelChildElements(e,t){for(var a=e.getElementsByTagName(t),o=[],n=0;n<a.length;n++)a[n].parentNode===e&&o.push(a[n]);return o}function findParentBySelector(e,t){for(var a=getEl(e),o=document.querySelectorAll(t),n=a.parentNode;n&&!collectionHas(o,n);)n=n.parentNode;return n}function getParamStringFromObject(e){var t=[];for(var a in e)"string"==typeof a&&t.push(a+"="+encodeURIComponent(e[a]));return t.join("&")}function toggleClass(e,t){var a=e.getAttribute("class");a=a.indexOf(t)>-1?a.replace(t,""):a+" "+t,e.setAttribute("class",a)}function svgSetTransform(e,t){var a=!0;if(a){"Infinity"===t.scale&&(t.scale=1);var o="matrix("+t.scale+",0,0,"+t.scale+","+t.translatex+","+t.translatey+")";e.setAttributeNS(null,"transform",o)}else{t.transformmatrix.a=t.scale,t.transformmatrix.b=0,t.transformmatrix.c=0,t.transformmatrix.d=t.scale,t.transformmatrix.e=t.translatex,t.transformmatrix.f=t.translatey;var n=e.ownerSVGElement.createSVGTransformFromMatrix(t.transformmatrix);e.transform.baseVal.initialize(n)}}function svgRetrieveZoomLevel(e){if(!e)return 1;var t=parseFloat(e.getAttributeNS(null,"transform").replace(/.*bla\(\s*(\d[^\,]*).*/g,"$1"));return isNaN(t)?1:t}function getTransformedWidth(e,t){var a=t.getTransformToElement(e);return a.a*t.cx.animVal.value}function rgbFromHex(e){function t(e){return parseInt(n(e).substring(0,2),16)}function a(e){return parseInt(n(e).substring(2,4),16)}function o(e){return parseInt(n(e).substring(4,6),16)}function n(e){return"#"===e.charAt(0)?e.substring(1,7):e}return{r:t(e),g:a(e),b:o(e)}}function colourGradientor(e,t,a){var o=(2*e-1+1)/2,n=1-o;return[parseInt(t[0]*o+a[0]*n,10),parseInt(t[1]*o+a[1]*n,10),parseInt(t[2]*o+a[2]*n,10)]}function encodeUrl(e){return escape(e).replace(/\+/g,"%2C").replace(/\"/g,"%22").replace(/\'/g,"%27").replace(/\//g,"%2F")}function generateUniqueId(){var e=Math.random();e=Math.round(1e4*e);var t=Math.random();t=Math.round(1e4*e);var a=new Date,o=a.getSeconds();return e=e+"x"+o+"x"+t}function iterate(e,t,a){for(var o in e)if(e.hasOwnProperty(o))if("object"==typeof e[o])iterate(e[o],t,a);else if(e[o]===a&&o===t){returnObj=e,matchFound=!0;break}return returnObj}function handleShibbolethLoginRequired(e){null==window.objStore.getlocalstorageitem("stateremembered")&&(location.hash.indexOf("login/")>-1?window.objStore.setlocalstorageitem("stateremembered",JSON.stringify(window.app.defaultpagestate)):window.objStore.setlocalstorageitem("stateremembered",JSON.stringify(window.objPageState.hash2object(location.hash)))),e?e(null,{authenticated:!1}):window.objLogin.logout()}function psv(e,t,a,o){var n,r="",i=!1;"prod"===window.objConfig.sitetype&&(i=!1),window.objLoading.show(),n=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),n.onreadystatechange=function(){if(4===this.readyState)if(200===this.status)if(window.objLoading.hide(),n.responseText.toLowerCase().indexOf('name="samlrequest"')>0)handleShibbolethLoginRequired(o);else if(i)try{var e=JSON.parse(n.responseText);e.hasOwnProperty("error")&&("Not authenticated"===e.error.message||"Token mismatch"===e.error.message)?(window.objStore.setlocalstorageitem("reloadtime",(new Date).getTime()/1e3),window.objLogin.logout()):o(null,e)}catch(e){o(e)}else{var e=JSON.parse(n.responseText);e.hasOwnProperty("error")&&("Not authenticated"===e.error.message||"Token mismatch"===e.error.message)?window.objLogin.logout():o(null,e)}else o(n.statusText)},r=getParamStringFromObject(a),n.open(e,t+("GET"===e?"?"+r:""),!0),n.crossDomain=!0,n.withCredentials=!0,"POST"===e?(n.timeout=4e4,n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send(r)):n.send()}function serverSideRequest(e){function t(){try{return new XMLHttpRequest}catch(e){return new ActiveXObject("Microsoft.XMLHTTP")}}var a,o,n,r,i=!0,l=!1,s=!1,d=!1,p=!1,u="",w="",c="post",g="",b=null;if(w="undefined"!=typeof e.url?e.url:"",b="undefined"!=typeof e.callback?e.callback:null,"undefined"!=typeof e.bypasscache&&"true"===e.bypasscache&&(p=!0),c="undefined"!=typeof e.method?e.method.toLowerCase():"get",a="undefined"!=typeof e.debug?e.debug+"":"false","true"===a.toLowerCase()&&(s=!0),g="undefined"!=typeof e.arrdata?e.arrdata:"","string"==typeof g&&(g="undefined"!=typeof e.formdata?e.formdata:""),s&&(g.debug="true"),"string"!=typeof g&&(l=!0),null==b&&(i=!1),s&&alert("Parameters recieved:\nstrUrl="+w+"\ncallbackFunction="+b+"\nstrMethod="+c+"\narrFormData="+g+"\nbolSubmitFormData="+l+"\nbolAsync="+i),p&&("post"===c?w+=w.indexOf("?")>0?"&rnd="+generateUniqueId():"?rnd="+generateUniqueId():"string"!=typeof g?g.rnd=generateUniqueId():(g=new Array,g.rnd=generateUniqueId(),l=!0)),l){var m=new Array;for(o in g)"function"!=typeof g[o]&&"object"!=typeof g[o]&&(n=encodeUrl(g[o]),m.push(o+"="+n));u=m.join("&"),s&&alert("Form data sent to server:\n"+u)}var f=t();if(i)return f.onreadystatechange=function(){4===this.readyState&&(200===this.status?(r=f.responseText,s&&alert("just before callback function\n\n"+r),b(null,r)):(r="ERROR: There was a problem retrieving the server side data:\n"+f.statusText,b(r)))};f.onreadystatechange=function(){},"get"===c.toLowerCase()&&u.length>0&&(w+="?"+u);try{f.open(c.toUpperCase(),w,i),l&&"post"===c.toLowerCase()?(f.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),f.send(u)):d?f.send(g):f.send(null)}catch(e){if(!i)return null;b(JSON.stringify(e))}return i?void 0:f.responseText}function countryClicked(e,t,a){var o=getEl(e);t?window.objPageState.mobile=!0:window.objPageState.mobile=!1,""!==e&&"#999999"!==o.style.fill&&"#999"!==o.style.fill&&"rgb(153, 153, 153)"!==o.style.fill&&"rgb(153,153,153)"!==o.style.fill?"detail"===window.objPageState.state.view&&window.objPageState.state.filter.oru===e&&"undefined"==typeof a?window.objPageState.updatepagestate({view:"worldmap",filter:{oru:"none",datasource:window.objDataFilter.state.filter.datasource,subtype:window.objDataFilter.state.filter.subtype}}):window.objPageState.updatepagestate({view:"undefined"==typeof a?"detail":a,filter:{oru:e,datasource:window.objDataFilter.state.filter.datasource,subtype:window.objDataFilter.state.filter.subtype}}):(getEl("messagelist").innerHTML="No data according to current sales data.",window.objLogin.showmessages())}function formatFinancialData(e){var t="";return parseFloat(e)<0?(e=0-parseFloat(e),t="("+setNumberSeperators(e)+")"):t=setNumberSeperators(e),t}function setNumberSeperators(e){var t="",a=new String(e);a=a.split(".");var o=a[1]?a[1]:"";a=a[0].split("").reverse();for(var n=0;n<=a.length-1;n++)t=a[n]+t,(n+1)%3==0&&a.length-1!==n&&(t=","+t);return""!=o&&(t+=".",t+=o),t.indexOf(".")>-1&&t.split(".")[1].length<2&&(t+="0"),t}function formatMoney(e,t,a,o,n){var t=isNaN(t=Math.abs(t))?2:t,o=void 0===o?".":o,a=void 0===a?",":a,n=void 0===n?"$":n,r=e<0?"-":"",i=parseInt(e=Math.abs(+e||0).toFixed(t),10)+"",l=(l=i.length)>3?l%3:0;return r+n+(l?i.substr(0,l)+a:"")+i.substr(l).replace(/(\d{3})(?=\d)/g,"$1"+a)+(t?o+Math.abs(e-i).toFixed(t).slice(2):"")}function loadUrlInBrowser(e){var t=!1;arguments.length>1&&(t=arguments[1]),window.objAnalytics.data.events.push({category:e.match(/^https?:\/\/.+\.(zip|dmg|txt|cfg|gz|pl|pdf)$/i)?"download":"link",action:"click",label:e}),window.app.state.webbrowser?t?window.open(e):location.href=e:t?window.open(e,"_system","location=no"):window.open(e,"_blank","location=no")}function hasProperty(e,t){return"object"==typeof e&&null!==e&&e.hasOwnProperty(t)}function isPublicSite(){return window.objConfig.sitetype.indexOf("public")>-1}function translateFragment(e){return window.objConfig.fragments.hasOwnProperty(e)?window.objConfig.fragments[e]:"["+e+"]"}function renderInfographic(e){"undefined"==typeof e.initial&&(e.initial=!0),"undefined"==typeof e.setall&&(e.setall=!0),generateArc({targetnode:objArcProps.targetnode,centerx:objArcProps.centerx,centery:objArcProps.centery,radius:objArcProps.radius,leftwrapper:null,angle:e.angle}),e.setall&&generateArc({targetnode:objArcProps.targetleftnode,centerx:objArcProps.centerx,centery:objArcProps.centery,radius:objArcProps.radius,leftwrapper:objArcProps.targetleftwrapper,angle:360-e.angle}),e.initial&&(objArcProps.anglestored=e.angle)}function applyInfographicDelta(e){renderInfographic(e>=objArcProps.anglestored?{angle:e,initial:!1,setall:!0}:{angle:e,initial:!1,setall:!1})}function generateArc(e){var t=360-e.angle;t<=0&&(t=.1);var a=[];a.push("M "),a.push(e.centerx+e.radius*Math.cos((270-t)*Math.PI/180)+" "),a.push(e.centery+e.radius*Math.sin((270-t)*Math.PI/180)+" A "),a.push(e.radius+" "+e.radius+" 0 "+(t<180?"1":"0")+" 0 "),a.push(e.centerx+e.radius*Math.cos(270*Math.PI/180)+" "),a.push(e.centery+e.radius*Math.sin(270*Math.PI/180)),null!=e.leftwrapper&&e.leftwrapper.setAttributeNS(null,"transform","rotate("+t+","+e.centerx+","+e.centery+")"),e.targetnode.setAttributeNS(null,"d",a.join(""))}function animateArc(e,t){var a={angle:e.start};TweenLite.to(a,t,{angle:e.end,onUpdate:function(){generateArc({targetnode:objArcProps.targetnode,centerx:objArcProps.centerx,centery:objArcProps.centery,radius:objArcProps.radius,leftwrapper:null,angle:a.angle}),generateArc({targetnode:objArcProps.targetleftnode,centerx:objArcProps.centerx,centery:objArcProps.centery,radius:objArcProps.radius,leftwrapper:objArcProps.targetleftwrapper,angle:360-a.angle})},onComplete:function(){objArcProps.anglestored=e.end}})}var objUtils={},matchFound=!1,returnObj={},objStore={vars:{uselocalstorage:!0},store:null,setlocalstorageitem:function(e,t){objStore.store.setItem(e,t)},getlocalstorageitem:function(e){return objStore.store.getItem(e)},removelocalstorageitem:function(e){objStore.store.removeItem(e)},init:function(){var e=this;try{var t="t_"+Date.now();localStorage.setItem(t,t);var a=localStorage.getItem(t);if(localStorage.removeItem(t),t!==a)throw new Error;objStore.store=window.localStorage}catch(t){e.vars.uselocalstorage=!1,objStore.store=new MemoryStorage}null==e.getlocalstorageitem("statguid")&&e.setlocalstorageitem("statguid","xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,a="x"==e?t:3&t|8;return a.toString(16)}))}};!function(e,t,a){"function"==typeof define&&define.amd?define("memorystorage",[],function(){return a()}):"object"==typeof exports?module.exports=a():e[t]=a()}(this,"MemoryStorage",function(){"use strict";function e(n){function r(){var e=Object.keys(i).filter(function(e){return!(e in t)});return e.concat(Object.keys(l))}n=n||"global";var i=o[n];if(i)return i;if(!(this instanceof e))return new e(n);i=o[n]=this;var l={};return Object.defineProperty(i,a,{enumerable:!1,configurable:!0,get:function(){return l}}),Object.defineProperty(i,"id",{enumerable:!0,configurable:!0,get:function(){return n}}),Object.defineProperty(i,"length",{enumerable:!0,configurable:!0,get:function(){return r().length}}),i.getItem=function(e){return e in t?this[a][e]:this[e]},i.setItem=function(e,o){e in t?this[a][e]=o:this[e]=o},i.removeItem=function(e){e in t?delete this[a][e]:delete this[e]},i.key=function(e){var t=r();return e>=0&&e<t.length?t[e]:null},i.clear=function(){for(var e,o=(Object.keys(this).filter(function(e){return!(e in t)})),n=0;e=o[n];n++)e in t||delete this[e];o=Object.keys(this[a]);for(var e,n=0;e=o[n];n++)delete this[a][e]},"undefined"==typeof Proxy?i:new Proxy(i,{ownKeys:function(){return r()}})}var t={clear:1,getItem:1,id:1,key:1,length:1,removeItem:1,setItem:1},a="__memorystorage_cloaked_items__",o={};return e});var objInfographic={},objArcProps={targetnode:null,targetleftwrapper:null,targetleftnode:null,centerx:150,centery:125,radius:100,angle:0,anglestored:0},objFooter={init:function(){}},objHeader={el:{backbutton:null,togglefavouritebutton:null,regionname:null,breadcrumb:null,breadcrumbmarquee:null,regionnamemarquee:null},state:{showbackbutton:!1,togglefavouritevisible:!1},hidebackbutton:function(){var e=this;TweenLite.to(e.el.backbutton,.3,{display:"none",onComplete:function(){}})},showbackbutton:function(){var e=this;e.state.showbackbutton&&TweenLite.to(e.el.backbutton,.3,{display:"block",onComplete:function(){}})},hidefavouritebutton:function(){var e=this;TweenLite.to(e.el.togglefavouritebutton,.3,{display:"none",onComplete:function(){}})},showfavouritebutton:function(){var e=this;TweenLite.to(e.el.togglefavouritebutton,.3,{display:"block",onComplete:function(){objBookmarks.isfavourite()?e.el.togglefavouritebutton.className=e.el.togglefavouritebutton.className+" selected":e.el.togglefavouritebutton.className=e.el.togglefavouritebutton.className.replace(" selected","")}})},togglefavourite:function(e){var t="fav_"+objPageState.state.filter.orulevel+"_"+objPageState.state.filter.mru+"_"+objPageState.state.filter.oru,a="";if(objBookmarks.isfavourite())objStore.removelocalstorageitem(t),e.className=e.className.replace(" selected",""),a="remove favourite";else{var o={oru:objPageState.state.filter.orulevel,mru:objPageState.state.filter.mru,region_id:objPageState.state.filter.oru,region_name:objOruFilter.getregionnamebyid(objPageState.state.filter.oru),breadcrumb:objMruFilter.getmrufilterbreadcrumb()};objStore.setlocalstorageitem(t,JSON.stringify(o)),e.className=e.className+" selected",a="add favourite"}objAnalytics.data.events.push({category:"button",action:"click",label:a}),objBookmarks.renderfavouritepanel()},btnbackclick:function(){var e=this;e.hidebackbutton(),e.hidefavouritebutton(),objHeader.setregionname(objMap.state.mapname),objPageState.updatepagestate({view:"worldmap",filter:{oru:"none"}})},setregionname:function(e){var t=this;if("undefined"!=typeof e)if(isPublicSite())for(var a=document.getElementsByClassName("region_info_title"),o=0;o<a.length;o++)a[o].innerHTML=e;else TweenLite.to(t.el.regionname,.3,{opacity:0,onComplete:function(){e!==objMap.state.mapname&&(e=objMap.state.mapname+" &bull; "+e),t.el.regionname.innerHTML=e,t.el.regionnamemarquee=new Marquee("region_name",{behavior:"scroll",direction:"rtl",interrupt:"no",step:.1}),t.el.regionname.scrollWidth>t.el.regionname.clientWidth||t.el.regionnamemarquee&&t.el.regionnamemarquee.pause(),TweenLite.to(t.el.regionname,.3,{opacity:1})}})},setbreadcrumb:function(e){var t=this;TweenLite.to(t.el.breadcrumb,.3,{opacity:0,onComplete:function(){t.el.breadcrumb.innerHTML=e,t.el.breadcrumbmarquee=new Marquee("filter_breadcrumb",{behavior:"scroll",direction:"rtl",interrupt:"no",step:.1}),t.el.breadcrumb.scrollWidth>t.el.breadcrumb.clientWidth||t.el.breadcrumbmarquee&&t.el.breadcrumbmarquee.pause(),TweenLite.to(t.el.breadcrumb,.3,{opacity:1})}})},init:function(){var e=this;e.el.backbutton=getEl("btn_back"),e.el.togglefavouritebutton=getEl("toggle_favourite"),e.el.regionname=getEl("region_name"),e.el.breadcrumb=getEl("filter_breadcrumb"),e.state.showbackbutton=app.state.width<768}},objMap={state:{visible:null},el:{mapwrapper:null},vars:{showdetailview:!1,regionidtoshow:null},data:null,maps:{world:{url:"jvector_world.svg"},region:{url:"philips_regions.svg"},market:{url:"philips_markets.svg"},country:{url:"jvector_countries.svg"}},getcolorforpercentage:function(e,t,a,o){var n=!0;e/=100;var r=[{pct:1e-7,color:t},{pct:.5,color:a},{pct:1,color:o}],i=2,l=0;return n&&(e<=.5?(i=1,e*=2):(l=1,i=2,e=2*(e-.5))),"rgb("+window.colourGradientor(e,[r[i].color.r,r[i].color.g,r[i].color.b],[r[l].color.r,r[l].color.g,r[l].color.b]).join(",")+")"},retrieveworldmapsvg:function(){var e=this;window.objTouchVars.elanimate=null,e.state.mapname=window.objOruFilter.convertoruleveltomarket(window.objPageState.state.filter.orulevel);var t=window.objStore.getlocalstorageitem("map_"+e.state.mapname+"_v5"),a=!0;if(t&&t.indexOf("<svg")>-1&&(a=!1),a){var o=[];return o.type="xml",o.file=e.maps[e.state.mapname.toLowerCase()].url,o.method="getsvgworldmap",o.fulldomain=location.protocol+"//"+location.hostname,o.token=window.objLogin.token,o.v=Math.random(),t=window.serverSideRequest({url:window.objConfig.urls.authurl2,formdata:o,method:"get",debug:!1}),t=t.replace(/fill:#00ffff/g,""),"string"==typeof t?(window.objStore.setlocalstorageitem("map_"+e.state.mapname+"_v5",t),t):""}return t.replace(/fill:#00ffff/g,"")},getworldmapdata:function(){var e,t=this;switch(window.objDataFilter.state.filter.datasource){case"lives_improved":case"":e={fulldomain:location.protocol+"//"+location.hostname,method:"getworldmapdata",type:"json",token:window.objLogin.token,oru:window.objPageState.state.filter.orulevel,mru:window.objPageState.state.filter.mru,snapshotid:window.objConfig.currentsnapshotid},window.psv("GET",window.objConfig.urls.dynamicresourceurl,e,function(e,a){null!=e?window.objError.show("There was an error retrieving the worldmap data. "+("object"==typeof e?JSON.parse(e):e),!0):a.hasOwnProperty("authenticated")&&!a.authenticated?window.handleShibbolethLoginRequired():a.hasOwnProperty("error")?window.objError.show("There was an error retrieving the worldmap data. "+a.error.message,!0):t.postprocessworldmapdata(a)});break;case"sustainability":t.postprocessworldmapdata(window.objData.sustainability);break;case"global_presence":t.postprocessworldmapdata(window.objData.global_presence)}},createDataTypeListForRegions:function(e){var t=[],a=[];return e.forEach(function(e){t=[],a=[];var o="philips_"+e.getAttribute("id");if(window.objData.sustainability&&window.objData.sustainability.snapshotdata){for(var n in window.objData.sustainability.snapshotdata[o])window.objData.sustainability.snapshotdata[o].hasOwnProperty(n)&&t.push(n);for(var n in window.objData.global_presence.snapshotdata[o])window.objData.global_presence.snapshotdata[o].hasOwnProperty(n)&&a.push(n)}}),{global_presence:a,sustainability:t}},postprocessworldmapdata:function(e){var t=this;window.objLoading.show(),t.data=e.snapshotdata;var a=window.getEl("svgcontentwrapper"),o=window.getFirstLevelChildElements(a,"path");if(0===o.length&&(o=window.getFirstLevelChildElements(a,"g")),1!==window.objOruFilter.state.selectedoru&&("global_presence"===window.objDataFilter.state.filter.datasource||"sustainability"===window.objDataFilter.state.filter.datasource)&&"all"!==window.objDataFilter.state.filter.subtype||"lives_improved"===window.objDataFilter.state.filter.datasource){var n=0,r=100;if("lives_improved"===window.objDataFilter.state.filter.datasource){for(var i in t.data)if(t.data[i].l>=0){var l=100*t.data[i].l/t.data[i].p;l>n&&(n=l),l<r&&(r=l)}}else for(var i in t.data)if(t.data[i][window.objDataFilter.state.filter.subtype]>=0){var l=100*t.data[i][window.objDataFilter.state.filter.subtype]/t.data.philips_world[window.objDataFilter.state.filter.subtype];l>n&&(n=l),l<r&&(r=l)}}else n=100,r=100;var s=0,d=(100-s)/(n-r);window.objConfig.colors[window.objPageState.state.filter.sector].hasOwnProperty("rgb")||(window.objConfig.colors[window.objPageState.state.filter.sector].rgb={},window.objConfig.colors[window.objPageState.state.filter.sector].rgb.low=window.rgbFromHex(window.objConfig.colors[window.objPageState.state.filter.sector].low),window.objConfig.colors[window.objPageState.state.filter.sector].rgb.middle=window.rgbFromHex(window.objConfig.colors[window.objPageState.state.filter.sector].middle),window.objConfig.colors[window.objPageState.state.filter.sector].rgb.high=window.rgbFromHex(window.objConfig.colors[window.objPageState.state.filter.sector].high));for(var p=0,u=100,w=0;w<o.length;w++){var c=o[w],g="UK"===c.id?"GB":c.id,i=window.objPageState.state.filter.mru+"_"+(4!==window.objPageState.state.filter.orulevel?g.toLowerCase():g),b=!!t.data[i]&&t.data[i];if(b){var m;m="lives_improved"===window.objDataFilter.state.filter.datasource?100*b.l/b.p||0:"all"!==window.objDataFilter.state.filter.subtype?100*b[window.objDataFilter.state.filter.subtype]/t.data.philips_world[window.objDataFilter.state.filter.subtype]||0:100,t.data[i].percentageLI=m;var f=window.objConfig.colors[window.objPageState.state.filter.sector].middle;t.data[i].color=f;var v=80;n>r&&(v=m*d),v>=100&&(v=100),v<0&&(v=0),v>p&&(p=v),v<u&&(u=v),t.intLivesImprovedPercentageMin=u,t.intLivesImprovedPercentageMax=p;var h=t.getcolorforpercentage(v,window.objConfig.colors[window.objPageState.state.filter.sector].rgb.low,window.objConfig.colors[window.objPageState.state.filter.sector].rgb.middle,window.objConfig.colors[window.objPageState.state.filter.sector].rgb.high);b.l<=100&&window.objConfig.hideinactivecountries&&(h="#999"),c.style.fill=h;for(var y=c.getElementsByTagName("*"),j=0;j<y.length;j++){var x=y[j];"path"!==x.nodeName&&"polygon"!==x.nodeName&&"rect"!==x.nodeName&&"g"!==x.nodeName&&"polyline"!==x.nodeName||(y[j].style.fill=h)}}else c.style.fill="#999"}t.el.rootanimate=window.getEl("viewport"),t.el.rootsvg=window.getEl("holder_1000").getElementsByTagName("svg")[0],t.resizeworldmap(),t.state.rootanimateattributevalues=t.retrievesvgelementobject(t.el.rootanimate);var S=!0;S?(window.objTouchSettings.debug=!1,window.objTouchSettings.debugtointerface=!1,window.objTouchSettings.debugtoconsole=!0,window.objZoomPanSettings.mobile=window.app.state.mobile,window.objZoomPanSettings.clickcallback=function(e){var t=e.srcElement;"undefined"==typeof t&&(t=e.originalTarget);var a=t.nodeName,o=t.id?t.id:"",n=t.parentNode,r=(n.nodeName,n.id?n.id:"");""===o&&(o=r),"path"!==a&&"g"!==a&&"polygon"!==a||window.countryClicked(o)},window.initSgvZoomPan(t.el.rootsvg,t.el.rootanimate)):window.initZoomPan(t.el.rootsvg),t.centerworldmap(t.el.rootanimate),window.isPublicSite()&&window.app.isMobile.any()===!1&&t.maximizeworldmap(t.el.rootanimate),window.objLoading.hide(),window.objHeader.setregionname(t.state.mapname),window.objHeader.setbreadcrumb(window.objMruFilter.getmrufilterbreadcrumb()),t.vars.showdetailview&&t.detailspanel(),t.vars.showdetailview=!1,t.el.elsvgholder.style.visibility="visible";var _=!1;"lives_improved"===window.objPageState.state.filter.datasource?_=!0:"all"===window.objDataFilter.state.filter.subtype&&(_=!0),1===parseInt(window.objPageState.state.filter.orulevel,10)&&_&&"worldmap"===window.objPageState.state.view&&"none"===window.objPageState.state.filter.oru&&window.countryClicked("world",window.app.isMobile.any(),"detail")},updatemap:function(e,t){var a=this;"boolean"==typeof e?a.vars.showdetailview=e:a.vars.showdetailview=!1,a.el.elsvgholder.style.visibility="hidden";var o=a.retrieveworldmapsvg();null!=o&&("function"==typeof t&&t(),window.removeHandlers(function(){a.el.elsvgholder.innerHTML="",a.el.elsvgholder.innerHTML=o;var e=window.getEl("svgcontentwrapper"),t=window.getFirstLevelChildElements(e,"path");0===t.length&&(t=window.getFirstLevelChildElements(e,"g")),a.datatypes=a.createDataTypeListForRegions(t),a.renderDataTypeFilters(),a.renderCountryList(t),a.getworldmapdata()}))},renderCountryList:function(e){var t='<ul class="c-region-list">';e.forEach(function(e){t+='<li class="mapselector" data-target="'+e.id+'">'+window.translateFragment(e.id)+"</li>"}),t+="</ul>",window.getEl("regions").innerHTML=t;for(var a=document.getElementsByClassName("mapselector"),o=0;o<a.length;o++)a[o].addEventListener("click",function(){window.countryClicked(this.getAttribute("data-target"),!0)},!1)},mapdatatypekeys:function(e){var t={value_co2:"c_o_2",value_fte:"number_of_employees",value_waste:"waste",value_water:"water",value_emissions:"emissions",value_emissionshaz:"emissionshaz",value_trc:"lwc_rate",value_wasterecycled:"recycled",value_sales:"number_sales",value_male:"percentage_male",value_female:"percentage_female",value_research:"r_and_d_centers",value_plants:"manufacturing_sites",value_assets:"number_assets",value_employees:"number_of_employees"};return t[e]?t[e]:e},renderDataTypeFilters:function(){var e=this,t='<ul><li class="datafilter" data-subtype="all">All data</li>';e.datatypes.sustainability.forEach(function(a){a.indexOf("value_")>-1&&(t+='<li class="datatypefilter" data-subtype="'+a+'">'+window.objConfig.fragments[e.mapdatatypekeys(a)]+"</li>")}),t+="</ul>",window.Sizzle("li[data-panel=sustainability] .datatype-filter")[0].innerHTML=t;var a='<ul><li class="datafilter" data-subtype="all">All data</li>';e.datatypes.global_presence.forEach(function(t){t.indexOf("value_")>-1&&(a+='<li class="datafilter" data-subtype="'+t+'">'+window.objConfig.fragments[e.mapdatatypekeys(t)]+"</li>")}),a+="</ul>",window.Sizzle("li[data-panel=global_presence] .datatype-filter")[0].innerHTML=a;for(var o=window.Sizzle(".datatype-filter li"),n=0;n<o.length;n++)o[n].addEventListener("click",window.objDataFilter.subtypeChanged,!1)},retrievesvgelementobject:function(e){var t=this;window.objSvgElementProperties={},window.objSvgElementProperties.translatex=0,window.objSvgElementProperties.translatey=0,window.objSvgElementProperties.scale=1;var a=window.findPos(e.ownerSVGElement);window.objSvgElementProperties.x=a[0],window.objSvgElementProperties.y=a[1];for(var o,n=0,r=t.el.rootanimate.attributes,i=r.length;n<i;n++)o=r.item(n),"transform"===o.nodeName,window.objSvgElementProperties[o.nodeName]=o.nodeValue;return window.objSvgElementProperties.transformmatrix=e.getCTM(),window.objSvgElementProperties.size=e.getBoundingClientRect(),window.objSvgElementProperties},resizeworldmap:function(){var e=this;"undefined"!=typeof e.el.rootsvg&&(e.el.rootsvg.setAttributeNS(null,"viewBox","0 0 "+window.app.state.width+" "+window.app.state.height),e.el.rootsvg.setAttributeNS(null,"enable-background","new 0 0 "+window.app.state.width+" "+window.app.state.height),e.el.elsvgholder.style.width=window.app.state.width+"px",e.el.elsvgholder.style.height=window.app.state.height+"px",e.el.rootsvg.setAttributeNS(null,"width",window.app.state.width),e.el.rootsvg.setAttributeNS(null,"height",getEl("map").clientHeight))},moveworldmap:function(e,t){if(null!=window.objTouchVars.elanimate){var a={gesture:{center:{pageX:0,pageY:0}},clientX:0,clientY:0,target:{tagName:"svg"}};window.handleClickTouchStart(a),window.objTouchVars.clickstart=!1,a={gesture:{center:{pageX:e,pageY:t}},clientX:e,clientY:t},window.handleDrag(a),window.handleClickTouchEnd(a)}},centerworldmap:function(e){var t=this;window.svgSetTransform(e,{scale:window.svgRetrieveZoomLevel(e),translatex:0,translatey:0,transformmatrix:{}}),t.moveworldmap(window.app.state.width/2-t.state.rootanimateattributevalues.size.width/2-t.state.rootanimateattributevalues.x,window.app.state.height/2-t.state.rootanimateattributevalues.size.height/2-t.state.rootanimateattributevalues.y),t.state.rootanimateattributevalues=t.retrievesvgelementobject(t.el.rootanimate)},maximizeworldmap:function(e){var t=this,a=1,o=0,n=0;window.app.state.width/window.app.state.height>=t.state.rootanimateattributevalues.size.width/t.state.rootanimateattributevalues.size.height?(a=window.app.state.height/t.state.rootanimateattributevalues.size.height,o=(window.app.state.width-t.state.rootanimateattributevalues.size.width*a)/2):(a=window.app.state.width/t.state.rootanimateattributevalues.size.width,n=(window.app.state.height-t.state.rootanimateattributevalues.size.height*a)/2),window.svgSetTransform(e,{scale:a,translatex:0,translatey:0,transformmatrix:{}}),t.moveworldmap(o,n),t.state.rootanimateattributevalues=t.retrievesvgelementobject(t.el.rootanimate)},hideSelectedCountries:function(){Array.prototype.slice.call(document.getElementsByClassName("active")).forEach(function(e){e.removeAttribute("class")})},zoomIn:function(){var e=this,t=e.state.rootanimateattributevalues.scale;if(t<5){window.svgSetTransform(e.el.rootanimate,{scale:t+1,translatex:0,translatey:0,transformmatrix:{}}),e.state.rootanimateattributevalues.scale=t+1;var a=1,o=0,n=0;window.app.state.width/window.app.state.height>=e.state.rootanimateattributevalues.size.width/e.state.rootanimateattributevalues.size.height?(a=window.app.state.height/e.state.rootanimateattributevalues.size.height,o=(window.app.state.width-e.state.rootanimateattributevalues.size.width*e.state.rootanimateattributevalues.scale)/2):(a=window.app.state.width/e.state.rootanimateattributevalues.size.width,n=(window.app.state.height-e.state.rootanimateattributevalues.size.height*e.state.rootanimateattributevalues.scale)/2),e.moveworldmap(o,n)}},zoomOut:function(){var e=this,t=e.state.rootanimateattributevalues.scale;t>1&&(window.svgSetTransform(e.el.rootanimate,{scale:t-1,translatex:0,translatey:0,transformmatrix:{}}),e.state.rootanimateattributevalues.scale=t-1,e.moveworldmap(e.state.rootanimateattributevalues.translatex,e.state.rootanimateattributevalues.translatey))},detailspanel:function(){var e=this;window.objOruFilter.state.selectedoruguid=window.objPageState.state.filter.oru,objBookmarks.isfavourite()?window.getEl("toggle_favourite").className=window.getEl("toggle_favourite").className+" selected":window.getEl("toggle_favourite").className=window.getEl("toggle_favourite").className.replace(" selected",""),window.objHeader.showbackbutton(),window.objHeader.showfavouritebutton(),window.app.el.outerwrapper.className=window.objConfig.sitetype+" "+window.window.objPageState.state.filter.sector;var t=window.objPageState.state.filter.mru+"_"+(window.objPageState.state.filter.oru.length<4?window.objPageState.state.filter.oru:window.objPageState.state.filter.oru.toLowerCase()),a=e.data[t],o=window.getEl(window.objPageState.state.filter.oru);if(o){o.style.opacity;window.TweenLite.to(o,0,{opacity:.7,onComplete:function(){e.hideSelectedCountries(),o.setAttribute("class","active"),window.app.state.width>768?e.updateui(a,window.objPageState.state.filter.oru,o):window.TweenLite.to(e.el.elsvgholder,.2,{opacity:0,onComplete:function(){e.updateui(a,window.objPageState.state.filter.oru,o)}})}})}},updateui:function(e,t,a){var o=this;o.setroundeddatainui(e),e.percentageLI>100&&(e.percentageLI=100),e.percentageLI>=10&&e.percentageLI<100&&(e.percentageLI=Math.round(e.percentageLI)),e.percentageLI<10&&e.percentageLI>.1&&(e.percentageLI=Math.round(10*e.percentageLI)/10),e.percentageLI<.1&&(e.percentageLI="< 0.1"),window.objRegionInfo.el.data.percentagelivesimproved.textContent=e.percentageLI+"%";var n=window.getEl("lives_improved_icons");n.innerHTML="";for(var r=0;r<100;r++){var i=document.createElement("img");r<e.percentageLI?i.setAttribute("src","img/person-selected.png"):i.setAttribute("src","img/person.png"),n.appendChild(i)}window.objHeader.setregionname(window.objOruFilter.getregionnamebyid(t.length<4?t:t.toLowerCase())),window.objRegionInfo.show(),window.TweenLite.to(a,.3,{opacity:1,onComplete:function(){}})},setroundeddatainui:function(e){var t=this,a=t.roundlivesimproveddataobject(e),o=window.getEl("region_info_wrapper lives_improved"),n=window.getEl("region_info_wrapper global_presence"),r=window.getEl("region_info_wrapper sustainability");"lives_improved"===window.objDataFilter.state.filter.datasource?(window.objRegionInfo.el.data.nrlivesimproved.textContent=a.displayl+" "+window.objConfig.fragments.million,window.objRegionInfo.el.data.labellivesimproved.textContent=window.objConfig.fragments.lives_improved,window.objRegionInfo.el.data.gdp.textContent="$"+a.displayg+a.labelg,window.objRegionInfo.el.data.population.textContent=a.displayp+a.labelp,window.TweenLite.to(n,.3,{opacity:0,"z-index":-1,onComplete:function(){}}),window.TweenLite.to(r,.3,{opacity:0,"z-index":-1,onComplete:function(){}}),window.TweenLite.to(o,.3,{opacity:1,"z-index":1,onComplete:function(){}})):"global_presence"===window.objDataFilter.state.filter.datasource?(window.objRegionInfo.el.data.assets.textContent=window.formatMoney(a.value_assets,0,",",".",""),
window.objRegionInfo.el.data.employees.textContent=window.formatMoney(a.value_employees,0,",",".",""),window.objRegionInfo.el.data.female.textContent=a.value_female+"%",window.objRegionInfo.el.data.male.textContent=a.value_male+"%",window.objRegionInfo.el.data.plants.textContent=a.value_plants,window.objRegionInfo.el.data.research.textContent=a.value_research,window.objRegionInfo.el.data.sales.textContent=window.formatMoney(a.value_sales,0,",",".",""),"all"!==window.objDataFilter.state.filter.subtype?t.hideOtherElements(window.objDataFilter.state.filter.subtype):t.showAllElements(),window.TweenLite.to(n,.3,{opacity:1,"z-index":1,onComplete:function(){}}),window.TweenLite.to(r,.3,{opacity:0,"z-index":-1,onComplete:function(){}}),window.TweenLite.to(o,.3,{opacity:0,"z-index":-1,onComplete:function(){}})):"sustainability"===window.objDataFilter.state.filter.datasource&&(window.objRegionInfo.el.data.co2.textContent=window.formatMoney(a.value_co2,0,",",".",""),window.objRegionInfo.el.data.emission.textContent=window.formatMoney(a.value_emissions,0,",",".",""),window.objRegionInfo.el.data.emissionhaz.textContent=window.formatMoney(a.value_emissionshaz,0,",",".",""),window.objRegionInfo.el.data.trc.textContent=a.value_trc,window.objRegionInfo.el.data.waste.textContent=window.formatMoney(a.value_waste,0,",",".",""),window.objRegionInfo.el.data.wasterecycled.textContent=window.formatMoney(a.value_wasterecycled,0,",",".",""),window.objRegionInfo.el.data.water.textContent=window.formatMoney(a.value_water.replace(",",""),0,",",".",""),"all"!==window.objDataFilter.state.filter.subtype?t.hideOtherElements(window.objDataFilter.state.filter.subtype):t.showAllElements(),window.TweenLite.to(n,.3,{opacity:0,"z-index":-1,onComplete:function(){}}),window.TweenLite.to(r,.3,{opacity:1,"z-index":1,onComplete:function(){}}),window.TweenLite.to(o,.3,{opacity:0,"z-index":-1,onComplete:function(){}}))},hideOtherElements:function(e){for(var t in window.objRegionInfo.el.data)window.objRegionInfo.el.data.hasOwnProperty(t)&&window.objRegionInfo.el.data[t].className!==e.replace("value_","nr_")&&(window.objRegionInfo.el.data[t].parentNode.style.display="none")},showAllElements:function(){for(var e in window.objRegionInfo.el.data)window.objRegionInfo.el.data.hasOwnProperty(e)&&(window.objRegionInfo.el.data[e].parentNode.style.display="block")},roundlivesimproveddataobject:function(e){var t=0;return e.l>=0&&(e.l>=1e9&&(e.roundedl=Math.round(e.l/1e6)),e.l>=1e8&&e.l<1e9&&(e.roundedl=Math.round(e.l/1e6*10)/10,t=1),e.l>=1e7&&e.l<1e8&&(e.roundedl=Math.round(e.l/1e6*100)/100,t=2),e.l<1e7&&(e.roundedl=Math.round(e.l/1e6*1e3)/1e3,t=3),e.displayl=window.formatMoney(e.roundedl,t,",",".",""),e.labell="million lives improved"),e.g>=0&&(e.g>1?(e.roundedg=Math.round(e.g/1),t=0):(e.roundedg=Math.round(e.g/1*10)/10,t=1),e.displayg=window.formatMoney(e.roundedg,t,",",".",""),e.labelg=" "+window.objConfig.fragments.billion),e.p>=0&&(e.p>1e6?(e.roundedp=Math.round(e.p/1e6),t=0):(e.roundedp=Math.round(e.p/1e6*10)/10,t=1),e.displayp=window.formatMoney(e.roundedp,t,",",".",""),e.labelp=" "+window.objConfig.fragments.million),e},init:function(){var e=this;e.state.visible=!1,e.el.elsvgholder=window.getEl("holder_1000")}},objOverlay={state:{visible:null,tweening:null},el:{wrapper:null,closebutton:null},show:function(e,t){var a=this,o="undefined"!=typeof t&&t;a.state.tweening=!0,a.el.wrapper.style.display="block",o&&!a.state.tweening?TweenLite.to(a.el.wrapper,.3,{opacity:.7,delay:0,onComplete:a.showcomplete(e)}):(a.el.wrapper.style.opacity=.7,a.showcomplete(e))},showcomplete:function(e){objOverlay.state.visible=!0,objOverlay.state.tweening=!1;var t="undefined"!=typeof e&&"boolean"!=typeof e;t&&e()},hide:function(e,t){var a=this,o="undefined"!=typeof t&&t;a.state.tweening=!0,o&&!a.state.tweening?TweenLite.to(a.el.wrapper,.3,{opacity:0,delay:0,onComplete:a.hidecomplete(e)}):a.hidecomplete(e)},hidecomplete:function(e){objOverlay.el.wrapper.style.display="none",objOverlay.state.visible=!1,objOverlay.state.tweening=!1;var t="undefined"!=typeof e&&"boolean"!=typeof e;t&&e()},btncloseclick:function(){objHeader.btnbackclick()},init:function(){var e=this;e.state.tweening=!1,e.state.visible=!1,e.el.wrapper=getEl("overlay"),isPublicSite()&&(e.el.wrapper.closebutton=getEl("loader"),e.el.wrapper.setAttributeNS(null,"onclick","objOverlay.btncloseclick();"))}},objRegionInfo={state:{visible:null,tweening:null,panel:"current"},el:{wrapper:null,nrlivesimproved:null,labellivesimproved:null,percentagelivesimproved:null,population:null,gdp:null},renderLegend:function(){var e=this;e.el.legend__title.innerHTML="all"===objDataFilter.state.filter.subtype?objConfig.fragments.lives_improved:objConfig.fragments[objMap.mapdatatypekeys(objDataFilter.state.filter.subtype)],e.el.legend__subtitle.innerHTML=""},hideEmptyEl:function(){Sizzle(".nr_label").forEach(function(e){""===e.getElementsByTagName("span")[0].innerText||objDataFilter.state.filter.subtype&&"all"!==objDataFilter.state.filter.subtype&&e.getElementsByTagName("span")[0].className!==objDataFilter.state.filter.subtype.replace("value_","nr_")?e.style.display="none":e.style.display="block"})},show:function(){var e=this;if(e.state.tweening=!0,e.hideEmptyEl(),isPublicSite()&&(objFilter.hide(),objOverlay.show()),objPageState.mobile===!0){e.removeMobileRegionInfos();var t=Sizzle("[data-target="+objPageState.state.filter.oru+"]")[0];t.className="mapselector selected",t.innerHTML=t.innerHTML+getEl(objDataFilter.state.filter.datasource).outerHTML,t.getElementsByClassName("region_info_wrapper")[0].removeAttribute("style")}else app.state.width>768?TweenLite.to(e.el.regionpanel,.3,{bottom:"0%",opacity:1,onComplete:e.showcomplete(e.el.regionpanel)}):TweenLite.to(e.el.regionpanel,.3,{bottom:"0%",opacity:1,onComplete:e.showcomplete(e.el.regionpanel)});var a=!0;a||isPublicSite()||(objPanelInfo.show("region_info"),objStore.setlocalstorageitem("seenRegionInfoIntro","true"))},showcomplete:function(e){var t=objRegionInfo;t.state.tweening=!1,t.state.visible=!0,TweenLite.to(t.el.toolspanel,.3,{bottom:"0%",opacity:0,"z-index":-1})},hide:function(){var e=this;e.state.visible&&(e.state.tweening=!0,app.state.width>768?TweenLite.to(e.el.regionpanel,.3,{bottom:"0%",opacity:0,onComplete:e.hidecomplete(e.el.regionpanel)}):TweenLite.to(e.el.regionpanel,.3,{bottom:"-86%",opacity:0,onComplete:e.hidecomplete(e.el.regionpanel)})),objPageState.mobile&&e.removeMobileRegionInfos(),objHeader.hidefavouritebutton()},hidecomplete:function(e){var t=objRegionInfo;t.state.tweening=!1,t.state.visible=!1,isPublicSite()&&objOverlay.state.visible&&objOverlay.hide(),TweenLite.to(t.el.toolspanel,.3,{bottom:"0%",opacity:1,"z-index":3})},removeMobileRegionInfos:function(){for(var e=Sizzle("[data-target] > div"),t=0;t<e.length;t++)e[t].parentNode.className="mapselector",e[t].parentNode.removeChild(e[t])},showsimulation:function(e){var e=this;e.el.btnshowcurrent.style.display="block",TweenLite.to(e.el.btnshowsimulation,.3,{opacity:0,onComplete:function(){e.showsimulationcomplete(),e.state.panel="simulation",e.el.btnshowsimulation.style.display="none"}}),TweenLite.to(e.el.btnshowcurrent,.3,{opacity:1,onComplete:e.showsimulationcomplete}),TweenLite.to(e.el.regionpanel,.3,{top:"-35%",onComplete:e.showsimulationcomplete}),TweenLite.to(e.el.toolspanel,.3,{bottom:"0%",onComplete:e.showsimulationcomplete})},showsimulationcomplete:function(){var e=objRegionInfo;e.state.tweening=!1,e.state.visible=!0},showcurrent:function(e){var e=this;e.el.btnshowsimulation.style.display="block",TweenLite.to(e.el.btnshowcurrent,.3,{opacity:0,onComplete:function(){e.showcurrentcomplete(),e.state.panel="current",e.el.btnshowcurrent.style.display="none"}}),TweenLite.to(e.el.toolspanel,.3,{bottom:"-35%",onComplete:e.showcurrentcomplete}),TweenLite.to(e.el.btnshowsimulation,.3,{opacity:1,onComplete:e.showcurrentcomplete}),TweenLite.to(e.el.regionpanel,.3,{top:"0%",onComplete:e.showcurrentcomplete})},showcurrentcomplete:function(){var e=objRegionInfo;e.state.tweening=!1,e.state.visible=!0},showhistory:function(){var e=this;TweenLite.to(e.el.history,.3,{opacity:1,onComplete:function(){e.state.tweening=!1,e.state.visible=!0}})},hidehistory:function(){var e=this;TweenLite.to(e.el.history,.3,{opacity:0,onComplete:function(){e.state.tweening=!1,e.state.visible=!0}})},init:function(){var e=this;e.state.visible=!1,e.state.tweening=!1,e.el.wrapper=getEl("region_info_wrapper"),e.el.regionpanel=getEl("region_info"),e.el.toolspanel=getEl("map_tools"),e.el.legend=getEl("map_tools__legend"),e.el.legend__title=getEl("map_tools__legend__title"),e.el.legend__subtitle=getEl("map_tools__legend__subtitle"),e.el.legend__top_value=getEl("map_tools__legend__top_value"),e.el.legend__low_value=getEl("map_tools__legend__low_value"),e.el.data={},e.el.data.nrlivesimproved=getEl("nr_lives_improved"),e.el.data.labellivesimproved=getEl("nr_lives_improved_label"),e.el.data.percentagelivesimproved=getEl("lives_improved_percentage"),e.el.data.population=getEl("nr_population"),e.el.data.gdp=getEl("nr_gdp"),e.el.data.assets=getEl("nr_assets"),e.el.data.employees=getEl("nr_employees"),e.el.data.female=getEl("nr_female"),e.el.data.male=getEl("nr_male"),e.el.data.plants=getEl("nr_plants"),e.el.data.research=getEl("nr_research"),e.el.data.sales=getEl("nr_sales"),e.el.data.co2=getEl("nr_co2"),e.el.data.emission=getEl("nr_emission"),e.el.data.emissionhaz=getEl("nr_emissionhaz"),e.el.data.trc=getEl("nr_trc"),e.el.data.waste=getEl("nr_waste"),e.el.data.wasterecycled=getEl("nr_wasterecycled"),e.el.data.water=getEl("nr_water"),e.el.btnshowcurrent=getEl("show_current"),e.el.btnshowsimulation=getEl("show_simulation"),e.el.history=getEl("graph"),e.el.regioninfotitle=getEl("region_info_title"),objArcProps.targetnode=getEl("arc_path"),objArcProps.targetleftwrapper=getEl("arc_path_left_wrapper"),objArcProps.targetleftnode=getEl("arc_path_left"),app.state.mobile&&(app.state.ipad?(Hammer(e.el.regionpanel).on("drag",function(t){"up"==t.gesture.direction&&t.gesture.distance>10&&e.hide()}),Hammer(e.el.toolspanel).on("drag",function(t){"up"==t.gesture.direction&&t.gesture.distance>10&&e.hide()})):(Hammer(e.el.regionpanel).on("drag",function(t){"up"==t.gesture.direction&&t.gesture.distance>10&&e.showsimulation(e),"simulation"==e.state.panel&&"down"==t.gesture.direction&&t.gesture.distance>10&&e.showcurrent(e)}),Hammer(e.el.toolspanel).on("drag",function(t){"down"==t.gesture.direction&&t.gesture.distance>10&&e.showcurrent(e)})))}},objSliders={state:{visible:null,tweening:null},el:{wrapper:null,innerwrapper:null,slidersales:null,slidergreensales:null},vars:{data:null,content:null,slidersalesvalue:0,slidergreensalesvalue:0,livesimprovedcurrent:0,simulatorsampling:!1,debug:!1,updatetrendgraph:!0,updatecurrent:!1,usebiliniarinterpolation:!0,debugstring:"",recalculatecounter:0,setupsimulator:!0},calculatefloorceil:function(e,t){var a=0,o=0,n=Math.round(e/t)*t;return e>=0?e%t>t/2?(o=n,a=o-t):(a=n,o=a+t):Math.abs(e%t)>t/2||e%t==0?(a=n,o=a+t):(o=n,a=o-t),{floor:a,ceil:o}},start:function(){var e=this;"PD0900"==objPageState.state.filter.sector?objSliders.el.slidergreensales.parentNode.style.visibility="hidden":objSliders.el.slidergreensales.parentNode.style.visibility="visible";var t={fulldomain:location.protocol+"//"+location.hostname,method:"getlivesimprovedcachedata",type:"json",oru:objPageState.state.filter.oru,mru:objPageState.state.filter.mru,snapshotid:objConfig.currentsnapshotid,token:objLogin.token};e.recalculatecounter=0,psv("GET",objConfig.urls.dynamicresourceurl,t,e.getsimulatordatahandler)},getsimulatordatahandler:function(e,t){var a=objSliders;e?objError.handleError("objSliders.start",e):t.hasOwnProperty("authenticated")&&!t.authenticated?handleShibbolethLoginRequired():hasProperty(t,"error")?objError.show(t.error.message,!0):(a.vars.setupsimulator=t.hasOwnProperty("sales")&&t.hasOwnProperty("greensales")&&t.hasOwnProperty("scenario"),a.vars.data=t,app.trendgraph.predictionlabel=a.vars.data.layout.simulatorlabel,app.trendgraph.predictiondate=a.vars.data.layout.simulatordate,app.trendgraph.stylecurrentline=a.vars.data.layout.simulatorstyle,a.vars.setupsimulator&&(getEl("simulation_header").innerHTML=a.vars.data.layout.simulatorlabel+app.labels.simulatortitle,a.el.errorwrapper.style.display="none"),a.vars.setupsimulator&&a.setupsimulator(),a.setuphistorygraph())},setuphistorygraph:function(){var e,t=this,a=t.vars.data.historicaldata,o={points:[],ymin:null,ymax:null},n="",r="",i=0,l=-1e12,s=1e12,d=/(\d{4})-(\d{2})-(\d{2})/;a.sort(function(e,t){return new Date(e.dateend)-new Date(t.dateend)});for(var p=0;p<a.length;p++){var u=a[p].l;if(u==-1&&(u=0),e=d.exec(a[p].dateend),o.points.push({value:objMap.roundlivesimproveddataobject({l:u,g:-1,p:-1}).displayl,label:a[p].name,dateend:a[p].dateend,utcend:Date.UTC(+e[1],+e[2]-1,+e[3])}),p==a.length-1){var w=new Date(a[p].dateend);n=""!=app.trendgraph.predictionlabel?app.trendgraph.predictionlabel:"Q4 "+(w.getMonth()+1==12?w.getFullYear()+1:w.getFullYear()),r=""!=app.trendgraph.predictiondate?app.trendgraph.predictiondate:(w.getMonth()+1==12?w.getFullYear()+1:w.getFullYear())+"-12-31",e=d.exec(r),i=Date.UTC(+e[1],+e[2]-1,+e[3])}u>l&&(l=u),u<s&&(s=u)}if(t.vars.setupsimulator&&t.vars.data.livesimproved.s0g0){o.points.push({value:objMap.roundlivesimproveddataobject({l:t.vars.data.livesimproved.s0g0,g:-1,p:-1}).displayl,label:n,dateend:r,utcend:i}),t.vars.data.livesimproved.s0g0>l&&(l=t.vars.data.livesimproved.s0g0),t.vars.data.livesimproved.s0g0<s&&(s=t.vars.data.livesimproved.s0g0);var c="s"+(t.vars.data.scenario.salesmin+"").replace(/\-/,"minus")+"g"+(t.vars.data.scenario.greensalesmin+"").replace(/\-/,"minus"),g="s"+(t.vars.data.scenario.salesmax+"").replace(/\-/,"minus")+"g"+(t.vars.data.scenario.greensalesmax+"").replace(/\-/,"minus"),b=t.vars.data.livesimproved[g],m=t.vars.data.livesimproved[c];b>l&&(l=b),m>=0&&m<s&&(s=m)}if(o.ymin=parseFloat(objMap.roundlivesimproveddataobject({l:s,g:-1,p:-1}).displayl.replace(/,/,"")),o.ymax=parseFloat(objMap.roundlivesimproveddataobject({l:l,g:-1,p:-1}).displayl.replace(/,/,"")),objTrendGraph.props.axis.ygridlines=3,o.ymax<.1&&(objTrendGraph.props.axis.ygridlines=null),null!=app.trendgraph.pointsvisible&&o.points.length>app.trendgraph.pointsvisible)for(var p=0;p<o.points.length-app.trendgraph.pointsvisible+1;p++)o.points.shift();o.styles={},o.styles.stylecurrentline=app.trendgraph.stylecurrentline,objTrendGraph.props.line.lastsegment.class="lastsegment",objTrendGraph.props.line.lastpoint.id="lp",objTrendGraph.reset(),objTrendGraph.drawgraph(o)},setupsimulator:function(){var e=this;e.el.slidersales.value=0,e.el.slidergreensales.value=0,e.el.slidersaleslabel.innerHTML="0%",null!=objRegionInfo.el.wrapper&&(objRegionInfo.el.wrapper.className=""),e.vars.slidersalesvalue=0;var t=objPageState.state.filter.mru+"_"+objPageState.state.filter.oru,a=objMap.data[t].l;e.vars.livesimprovedcurrent=a,e.vars.gsp=objMap.data[t].gsp==-1?0:Math.round(100*objMap.data[t].gsp),e.vars.gspslidermin=e.vars.gsp- -e.vars.data.scenario.greensalesmin<0?0:e.vars.gsp- -e.vars.data.scenario.greensalesmin,e.vars.gspslidermax=e.vars.gsp+e.vars.data.scenario.greensalesmax>100?100:e.vars.gsp+e.vars.data.scenario.greensalesmax,e.vars.greensalesmin=e.vars.gsp- -e.vars.data.scenario.greensalesmin<0?e.vars.gsp:e.vars.data.scenario.greensalesmin,e.vars.greensalesmax=e.vars.gsp+e.vars.data.scenario.greensalesmax>100?100-e.vars.gsp:e.vars.data.scenario.greensalesmax,e.vars.salesmax=e.vars.data.scenario.salesmax,e.vars.salesmin=e.vars.data.scenario.salesmin,e.el.slidergreensaleslabel.innerHTML=e.vars.gsp+"%",e.vars.slidergreensalesvalue=e.vars.gsp,e.el.slidergreensales.value=0,e.el.salesmin.innerHTML=e.vars.data.scenario.salesmin,e.el.salesmax.innerHTML=e.vars.data.scenario.salesmax,e.el.greensalesmin.innerHTML=e.vars.gspslidermin,e.el.greensalesmax.innerHTML=e.vars.gspslidermax,e.el.slidersales.setAttribute("min",e.vars.data.scenario.salesmin),e.el.slidersales.setAttribute("max",e.vars.data.scenario.salesmax),e.el.slidergreensales.setAttribute("min",e.vars.gspslidermin-e.vars.gsp),e.el.slidergreensales.setAttribute("max",e.vars.gspslidermax-e.vars.gsp);var o=Math.abs(e.vars.data.scenario.salesmin)/(Math.abs(e.vars.data.scenario.salesmin)+e.vars.salesmax)*100-2,n=(e.vars.gsp-e.vars.gspslidermin)/(e.vars.gspslidermax-e.vars.gspslidermin)*100-3;getEl("saleszero").style.left=o+"%",getEl("greensaleszero").style.left=n+"%",e.el.greensaleszero.innerHTML=e.vars.gsp,e.el.greensaleszero.style.display=n>85||0==e.vars.gsp?"none":"inline",e.vars.simulatorsampling=!0,e.executeslidersampling()},executeslidersampling:function(){var e=this,t=e.el.slidersales.value,a=e.el.slidergreensales.value;t==e.vars.slidersalesvalue&&a==e.vars.slidergreensalesvalue||(e.calculatevalue(t,a),1==e.recalculatecounter&&objAnalytics.data.events.push({category:"simulator",action:"slide",label:"simulator change"}),e.recalculatecounter++),e.vars.slidersalesvalue=Math.round(10*t)/10,e.vars.slidergreensalesvalue=Math.round(10*a)/10,e.vars.simulatorsampling&&(e.vars.timersimulator=setTimeout(function(){e.executeslidersampling()},100))},calculatevalue:function(e,t){var a=this;e=parseFloat(e,10),t=parseFloat(t,10),a.el.slidersaleslabel.innerHTML=(e>0?"+":"")+Math.round(10*e)/10+"%",a.el.slidergreensaleslabel.innerHTML=Math.round(10*(t+a.vars.gsp))/10+"%";var o=0;if(a.vars.usebiliniarinterpolation){var n=0,r=0,i=0,l=0,s={},d=0,p=0,p=0,u=0,w="",c=0,g=0;e==a.vars.salesmax&&(e-=1e-4),t==a.vars.greensalesmax&&(t-=1e-4),a.vars.debug&&(a.vars.debugstring=""),s=a.calculatefloorceil(e,a.vars.data.scenario.salesstep),n=s.floor,r=s.ceil,s=a.calculatefloorceil(t,a.vars.data.scenario.greensalesstep),i=s.floor,l=s.ceil,a.vars.debug&&(a.vars.debugstring+="- sfloor="+n+"<br/>- sceil="+r+"<br/>- gsfloor="+i+"<br/>- gsceil="+l+"<br/>"),w="s"+(n+"").replace(/-/,"minus")+"g"+(i+"").replace(/-/,"minus"),d=a.vars.data.livesimproved[w],a.vars.debug&&(a.vars.debugstring+="- q11 key="+w+", value="+d+"<br/>"),w="s"+(r+"").replace(/-/,"minus")+"g"+(i+"").replace(/-/,"minus"),p=a.vars.data.livesimproved[w],a.vars.debug&&(a.vars.debugstring+="- q21 key="+w+", value="+p+"<br/>"),w="s"+(n+"").replace(/-/,"minus")+"g"+(l+"").replace(/-/,"minus"),q12=a.vars.data.livesimproved[w],a.vars.debug&&(a.vars.debugstring+="- q12 key="+w+", value="+q12+"<br/>"),w="s"+(r+"").replace(/-/,"minus")+"g"+(l+"").replace(/-/,"minus"),u=a.vars.data.livesimproved[w],a.vars.debug&&(a.vars.debugstring+="- q22 key="+w+", value="+u+"<br/>"),c=(r-e)/(r-n)*d+(e-n)/(r-n)*p,g=(r-e)/(r-n)*q12+(e-n)/(r-n)*u,o=(l-t)/(l-i)*c+(t-i)/(l-i)*g,a.vars.debug&&(null==getEl("debug")||(getEl("debug").innerHTML=a.vars.debugstring),a.vars.debugstring="")}if(0==isNaN(o)){var b=objMap.data[objPageState.state.filter.mru+"_"+objPageState.state.filter.oru].p,m=Math.round(o/b*100);a.vars.updatecurrent&&(a.el.livesimprovednumber.innerHTML=objMap.roundlivesimproveddataobject({l:o,g:-1,p:-1}).displayl.replace(/,/,""),a.el.livesimprovedpercentage.textContent=m+"%",applyInfographicDelta(360*m/100),o>a.vars.livesimprovedcurrent?objRegionInfo.el.wrapper.setAttribute("class","more"):o<a.vars.livesimprovedcurrent?objRegionInfo.el.wrapper.setAttribute("class","less"):objRegionInfo.el.wrapper.setAttribute("class","equal")),a.vars.updatetrendgraph&&objTrendGraph.updatelastpointingraph(parseFloat(objMap.roundlivesimproveddataobject({l:o,g:-1,p:-1}).displayl.replace(/,/,"")))}},togglesimulator:function(e){var t=this;t.vars.setupsimulator=e,t.el.innerwrapper.style.display=e?"block":"none"},init:function(){var e=this;e.state.visible=!1,e.state.tweening=!1,e.el.wrapper=getEl("simulation"),e.el.innerwrapper=getEl("simulation_wrapper"),e.el.errorwrapper=getEl("simulation_error_wrapper"),e.el.slidersales=getEl("slidersales"),e.el.slidergreensales=getEl("slidergreensales"),e.el.slidersaleslabel=getEl("value_sales"),e.el.slidergreensaleslabel=getEl("value_green_sales"),e.el.livesimprovednumber=getEl("nr_lives_improved"),e.el.livesimprovedpercentage=getEl("lives_improved_percentage"),e.el.history=getEl("region_history"),e.el.salesmin=getEl("salesmin"),e.el.salesmax=getEl("salesmax"),e.el.greensalesmin=getEl("greensalesmin"),e.el.greensalesmax=getEl("greensalesmax"),e.el.saleszero=getEl("saleszero"),e.el.greensaleszero=getEl("greensaleszero"),getEl("simulation_header").innerHTML=app.labels.simulatortitle,e.vars.content=e.el.wrapper.innerHTML}},objLogin={token:null,role:"",state:{visible:null,tweening:null,usernamedisabled:null,passworddisabled:null,authenticating:null,messages:[]},vars:{},el:{wrapper:null,submit:null},btnsubmitclick:function(){var e=window.objConfig.urls.hasOwnProperty("urlshiblogin")?window.objConfig.urls.urlshiblogin:"https://www.livesimproved.philips.com/tools/shibboleth-authenticate.aspx";location.href=e+"?rnd="+Math.random()},findlatestsnapshotid:function(e){window.objConfig.snapshots=e.snapshotconfig;var t=new Date("1970-01-01"),a="";if(null!=window.objConfig.snapshots)for(var o=0;o<window.objConfig.snapshots.length;o++){var n=window.objConfig.snapshots[o],r=new Date(n.dateend);r-t>0&&(a=n.snapshotid,t=new Date(n.dateend))}window.objConfig.currentsnapshotid=a},getsnapshotconfig:function(){var e=this,t={type:"json",fulldomain:location.protocol+"//"+location.hostname,method:"getsnapshotdetailssimple",token:objLogin.token};window.psv("GET",window.objConfig.urls.authurl2,t,function(t,a){t||window.hasProperty(a,"error")?window.hasProperty(a,"error")?window.objError.show("There was an error retrieving snapshot information. "+("object"==typeof a?JSON.stringify(a):a),!0):window.objError.show("There was an error retrieving snapshot information. "+("object"==typeof t?JSON.stringify(t):t),!0):"undefined"==typeof a||"string"==typeof a||null===a?(window.objError.show("There was an error retrieving snapshot information. No data was received...",!0),window.handleShibbolethLoginRequired()):a.hasOwnProperty("authenticated")&&!a.authenticated?window.handleShibbolethLoginRequired():(e.findlatestsnapshotid(a),e.checkappconfigforupdates(a),window.isPublicSite()?(objLogin.token=window.generateUniqueId().replace(/x/g,""),e.continueretrievemetadata()):e.checksession())})},checksession:function(){var e={fulldomain:location.protocol+"//"+location.hostname,method:"checksession",type:"json"};window.psv("GET",window.objConfig.urls.authurl2,e,function(e,t){e||window.hasProperty(t,"error")?window.hasProperty(t,"error")?window.objError.show("There was an error retrieving session information. "+("object"==typeof t?JSON.stringify(t):t),!0):window.objError.show("There was an error retrieving session information. "+("object"==typeof e?JSON.stringify(e):e),!0):t.authenticated?(objLogin.token=t.token,objLogin.continueretrievemetadata()):window.handleShibbolethLoginRequired()})},continueretrievemetadata:function(){window.app.defaultpagestate.view="worldmap",window.app.retrievemetadata()},checksnapshotconfigforupdates:function(e){var t=this,a=window.objStore.getlocalstorageitem("snapshotconfig"),o=e.snapshotconfig;if(a){a=JSON.parse(a).snapshotconfig;for(var n=0;n<o.length;n++){for(var r=!1,i=0;i<a.length;i++)if(o[n].snapshotid===a[i].snapshotid&&(r=!0,o[n].lastmodified!==a[i].lastmodified)){t.state.messages.push('There is updated data for "'+o[n].name+'".');break}r||t.state.messages.push('A new data set "'+o[n].name+'" has been added.')}}window.objStore.setlocalstorageitem("snapshotconfig",JSON.stringify(e))},checkappconfigforupdates:function(e){var t=this,a=window.objStore.getlocalstorageitem("appconfig"),o=e.appinfo,n="";window.app.state.mobile?(n="<b>New release available</b><p>A new version ("+(window.app.state.ios?o.iosid:o.androidid)+") of the Lives Improved app is available.</p>",n+='<p>Please visit the <span class="mimiclink" onclick="loadUrlInBrowser(\'https://www.livesimproved.philips.com/download\', true)">Lives Improved website</span> to download and install this new version.</p>',n+="<p>Details:</p>",a&&(a=JSON.parse(a),window.app.state.ios?a.iosid!==o.iosid&&(t.state.messages.push(n),t.state.messages.push(o.iosdescription)):a.androidid!==o.androidid&&(t.state.messages.push(n),t.state.messages.push(o.andrioddescription)))):(n="<b>The Lives Improved website has updated</b>",n+="<p>Details:</p>",a=a?JSON.parse(a):null,a?a.iosid!==o.iosid&&(t.state.messages.push(n),t.state.messages.push(o.iosdescription)):(t.state.messages.push(n),t.state.messages.push(o.iosdescription))),window.objStore.setlocalstorageitem("appconfig",JSON.stringify(e.appinfo))},hide:function(){var e=this;e.state.tweening=!0,window.app.state.ios?(e.el.wrapper.style.display="none",e.state.tweening=!1,e.state.visible=!1):window.TweenLite.to(e.el.wrapper,.3,{opacity:0,onComplete:function(){e.el.wrapper.style.display="none",e.state.tweening=!1,e.state.visible=!1}})},show:function(){var e=this;window.objSliders.vars.simulatorsampling=!1,e.el.wrapper.style.display="block",e.state.tweening=!0,window.app.state.ios?(e.el.wrapper.style.opacity=1,e.state.tweening=!1,e.state.visible=!0,location.href=window.objConfig.urls.urlshiblogin+"?rnd="+Math.random()):window.TweenLite.to(e.el.wrapper,.3,{opacity:1,onComplete:function(){e.state.tweening=!1,e.state.visible=!0,location.href=window.objConfig.urls.urlshiblogin+"?rnd="+Math.random()}})},logout:function(){window.objStore.removelocalstorageitem("token"),window.objPageState.updatepagestate({view:"login"})},showupdatemessages:function(){var e=this;if(window.getEl("messagelist").innerHTML="",e.state.messages.length>0){for(var t=0;t<e.state.messages.length;t++)window.getEl("messagelist").innerHTML+="<li>"+e.state.messages[t]+"</li>";e.state.messages=[],e.showmessages()}},hidemessages:function(){var e=this;e.state.tweening=!0,window.TweenLite.to(e.el.messagespanel,.3,{opacity:0,onComplete:function(){window.objOverlay.hide(),e.el.messagespanel.style.display="none",e.state.tweening=!1,e.state.visible=!1}})},showmessages:function(){var e=this;window.objOverlay.show(),e.state.tweening=!0,e.el.messagespanel.style.display="block",window.TweenLite.to(e.el.messagespanel,.3,{opacity:1,onComplete:function(){e.state.tweening=!1,e.state.visible=!0}})},init:function(){var e=this;e.state.passworddisabled=!1,e.state.usernamedisabled=!1,e.state.authenticating=!1,e.el.wrapper=window.getEl("login_panel"),e.el.submit=window.getEl("btn_submit"),e.el.messagespanel=window.getEl("messages_panel"),e.token=window.objStore.getlocalstorageitem("token")}},objError={state:{visible:null,tweening:null},el:{wrapper:null,text:null},hide:function(){var e=this;e.el.wrapper.innerHTML="",e.state.tweening=!0,TweenLite.to(e.el.wrapper,.3,{height:0,onComplete:function(){e.state.tweening=!1,e.state.visible=!1}})},show:function(e,t){var a=this;a.el.wrapper.innerHTML=e,a.state.tweening=!0,TweenLite.to(a.el.wrapper,.3,{height:50,onComplete:function(){if(a.state.tweening=!1,a.state.visible=!0,t){setTimeout(function(){a.hide()},4e3)}}})},handleError:function(e,t){var a=this;objLoading.state.visible&&objLoading.hide(),objOverlay.state.visible&&objOverlay.hide(),t.message&&(t=t.message),t.line?a.show("JS Error: line="+t.line+", message="+t.message+", stack="+t.stack,!0):"string"==typeof t?"token mismatch"==t.toLowerCase()||"not authenticated"==t.toLowerCase()?objLogin.show():a.show(t,!0):a.show(JSON.stringify(t),!0)},init:function(){var e=this;e.state.visible=!1,e.state.tweening=!1,e.el.wrapper=getEl("error")}},objFilter={state:{visible:null,tweening:null,currentfilterhtml:""},el:{wrapper:null,filtercontent:null},show:function(){var e=this;e.state.currentfilterhtml=e.el.filtercontent.innerHTML,window.isPublicSite()||window.objOverlay.show(),e.state.tweening||(e.state.tweening=!0,e.el.wrapper.style.display="block",window.TweenLite.to(e.el.wrapper,.3,{opacity:1,onComplete:e.showcomplete})),window.objMruFilter.setmrufilterstate(),window.objOruFilter.setorufilterstate();var t=!0;t||window.isPublicSite()||(window.objPanelInfo.show("filter"),window.objStore.setlocalstorageitem("seenFilterIntro","true"))},showcomplete:function(){objFilter.state.tweening=!1,objFilter.state.visible=!0},hide:function(){var e=this;e.state.tweening||(e.state.tweening=!0,window.TweenLite.to(e.el.wrapper,.3,{opacity:0,onComplete:function(){window.isPublicSite()||window.objOverlay.hide(),e.el.filtercontent.innerHTML=e.state.currentfilterhtml,e.el.wrapper.style.display="none",e.state.tweening=!1,e.state.visible=!1,e.el.btnapply.style.display="none"}}))},blink:function(){var e=this;window.isPublicSite()?e.blinkcomplete():window.TweenLite.to(e.el.filtercontent,.2,{opacity:.5,onComplete:function(){e.el.loader.style.display="block",window.TweenLite.to(e.el.filtercontent,.4,{opacity:1,onComplete:e.blinkcomplete})}})},blinkcomplete:function(){objFilter.el.loader.style.display="none",objFilter.el.btnapply.style.display="block"},applyfilter:function(){var e=this;window.isPublicSite()||!e.state.visible||e.state.tweening||e.hide(),e.state.currentfilterhtml=e.el.filtercontent.innerHTML,e.el.btnapply.style.display="none",window.isPublicSite()?window.objPageState.updatepagestate({view:"worldmap",filter:{datasource:window.objDataFilter.state.filter.datasource,subtype:window.objDataFilter.state.filter.subtype,orulevel:window.objOruFilter.state.selectedoru,oru:"none",sector:window.objMruFilter.state.selectedsector,mru:window.objMruFilter.state.selectedmru}}):window.objPageState.updatepagestate({view:"worldmap",filter:{datasource:window.objDataFilter.state.filter.datasource,subtype:window.objDataFilter.state.filter.subtype,orulevel:window.objOruFilter.state.selectedoru,oru:"none",sector:window.objMruFilter.state.selectedsector,mru:window.objMruFilter.state.selectedmru}}),window.objRegionInfo.state.visible&&!window.objRegionInfo.state.tweening&&window.objRegionInfo.hide()},init:function(){var e=this;e.state.visible=!1,e.state.tweening=!1,e.el.wrapper=window.getEl("filter_panel"),e.el.loader=window.getEl("filter_loader"),e.el.filtercontent=window.Sizzle("#filter_panel div.modal_content")[0],e.el.btnapply=window.getEl("btn_apply_filter"),e.el.btnapply.style.display="none",e.state.currentfilterhtml=e.el.filtercontent.innerHTML}},objBookmarks={state:{visible:null,tweening:null},el:{wrapper:null},isfavourite:function(){var e="fav_"+objPageState.state.filter.orulevel+"_"+objPageState.state.filter.mru+"_"+objPageState.state.filter.oru,t=objStore.getlocalstorageitem(e);return null!=t},addbookmark:function(){},removefavourite:function(e,t){e.stopPropagation();var a=t.parentNode,o=a.getAttribute("data-key");return objStore.removelocalstorageitem("fav_"+o),TweenLite.to(a,.2,{left:"100%",delay:0,onComplete:function(){TweenLite.to(a,.3,{height:0,delay:0,onComplete:function(){return a.parentNode.removeChild(a),!1}})}}),!1},findfavourites:function(){var e=[];if(objStore.vars.uselocalstorage)for(var t=0;t<objStore.store.length;t++){var a=localStorage.key(t);a.indexOf("fav_")>-1&&e.push(objStore.store.getItem(a))}return e},renderfavouritepanel:function(){for(var e=this,t='<div style="padding: 10px">Use the heart icon to add your favourite combinations to this bookmark list.</div>',a=e.findfavourites(),o=document.createElement("ul"),n=0;n<a.length;n++){var r=JSON.parse(a[n]),i=objMruFilter.getsectorfrombreadcrumb(r.breadcrumb),l=document.createElement("li");l.setAttribute("data-oru",r.oru),l.setAttribute("data-mru",r.mru),l.setAttribute("data-region",r.region_id),l.setAttribute("data-sector",i);var s=r.oru+"_"+r.mru+"_"+(4!=r.oru?r.region_id.toLowerCase():r.region_id);l.setAttribute("data-key",s),l.innerHTML='<div class="bookmark_color" style="background:'+objConfig.colors[i].middle+'"></div><h2>'+r.region_name+'</h2><span class="bookmark_sub">'+r.breadcrumb+'</span><div class="remove_bookmark" onclick="objBookmarks.removefavourite(event, this);return false;"></div>',l.onclick=function(){e.openfavourite(this.getAttribute("data-oru"),this.getAttribute("data-mru"),this.getAttribute("data-region"),this.getAttribute("data-sector"))},o.appendChild(l)}e.el.list.innerHTML="",0==a.length?e.el.list.innerHTML=t:e.el.list.appendChild(o)},openfavourite:function(e,t,a,o){var n=this;objOruFilter.state.selectedoru=e,
objMruFilter.state.selectedmru=t,objMruFilter.state.selectedsector=o,objOruFilter.settocurrentoru(),objPageState.updatepagestate({view:"detail",filter:{orulevel:e,oru:a,sector:o,mru:t}}),n.hide()},show:function(){var e=this;objOverlay.show(),e.state.tweening=!0,e.el.wrapper.style.display="block",TweenLite.to(e.el.wrapper,.3,{opacity:1,onComplete:function(){e.state.tweening=!1,e.state.visible=!0}})},hide:function(){var e=this;e.state.tweening=!0,TweenLite.to(e.el.wrapper,.3,{opacity:0,onComplete:function(){objOverlay.hide(),e.el.wrapper.style.display="none",e.state.tweening=!1,e.state.visible=!1}})},init:function(){var e=this;e.state.visible=!1,e.state.tweening=!1,e.el.wrapper=getEl("bookmarks_panel"),e.el.list=getEl("bookmarkslist"),e.renderfavouritepanel()}},objExplain={state:{visible:null,tweening:null,contentloaded:!1},el:{wrapper:null,content:null},show:function(){var e=this;objOverlay.show(),e.state.tweening=!0,e.el.wrapper.style.display="block",TweenLite.to(e.el.wrapper,.3,{opacity:1,onComplete:function(){e.state.tweening=!1,e.state.visible=!0,e.state.contentloaded||serverSideRequest({url:objConfig.urls.base+"/data/faq.html"+(location.href.indexOf("http")>-1?"?rnd="+Math.random():""),method:"get",debug:!1,callback:function(t,a){e.el.content.innerHTML=a,e.state.contentloaded=!0}})}})},hide:function(){var e=this;e.state.tweening=!0,TweenLite.to(e.el.wrapper,.3,{opacity:0,onComplete:function(){objOverlay.hide(),e.el.wrapper.style.display="none",e.state.tweening=!1,e.state.visible=!1}})},showfaqcontent:function(e,t){for(var a=Sizzle("#explain_content div.selected"),o=0;o<a.length;o++)a[o].className=a[o].className.replace(" selected","");e.className+=" selected",getEl(t).className+=" selected"},init:function(){var e=this;e.state.visible=!1,e.state.tweening=!1,e.el.wrapper=getEl("explain_panel"),e.el.content=getEl("explain_content")}},objTrendGraph={state:{valuepopupopen:!1,trendpopupflipped:!1},vars:{popuptrendwidth:0,popuptrendheight:0,popuptrendtextwrapperheight:0,popupvaluewidth:0,popupvalueheight:0,data:null,template:null},el:{root:null,lastsegment:null,lastpoint:null,popuptrend:null,popuptrendbase:null,popuptrendnumber:null,popuptrendtextwrapper:null,popupvalue:null,popupvaluenumber:null},props:{width:640,height:300,padding:{top:60,bottom:40,left:45,right:45},axis:{ymin:4,ymax:15,ystep:2.5,ygridlines:null,ygridlinesfullwidth:!0,showxlines:!1,xlinelength:8,showylines:!1,ylinelength:8,ylabelinset:!0,xpaddingleft:35,xpaddingright:10,ypaddingtop:20,ypaddingbottom:20},labels:{x:{padding:{bottom:20}},y:{translate:{x:0,y:8}}},coordinatepoint:{radius:5},title:{text:"Trend"},line:{lastsegment:{id:"last_segment",class:"last"},lastpoint:{id:"last_point",class:"last"}}},getsvgcoordinatesforpointflex:function(e,t){var a=this,o=a.props.height-a.props.padding.top-a.props.padding.bottom-a.props.axis.ypaddingtop-a.props.axis.ypaddingbottom,n=a.props.axis.ymax-a.props.axis.ymin,r=a.props.width-a.props.padding.left-a.props.padding.right-a.props.axis.xpaddingleft-a.props.axis.xpaddingright,i=a.vars.data.points[a.vars.data.points.length-1].utcend-a.vars.data.points[0].utcend;return 0==n&&(n=.001),isNaN(e)&&(e=parseFloat((e+"").replace(/,/,""))),{x:a.props.padding.left+a.props.axis.xpaddingleft+r/i*(t-a.vars.data.points[0].utcend),y:a.props.padding.top+(o-o/n*(e-a.props.axis.ymin))+a.props.axis.ypaddingtop}},createcoordinatepoint:function(e,t,a,o){for(var n=this,r=0;r<2;r++){var i=document.createElementNS("http://www.w3.org/2000/svg","circle");i.setAttributeNS(null,"cx",t.x+""),i.setAttributeNS(null,"cy",t.y+""),i.setAttributeNS(null,"r",0==r?30:n.props.coordinatepoint.radius),i.setAttributeNS(null,"data-value",n.correctlabeldecimals(a.value+"",n.props.axis.ymax+"")),i.setAttributeNS(null,"data-label",a.label),i.setAttributeNS(null,"class",0==r?"hitarea":"point"),""!=o?1==r&&i.setAttributeNS(null,"id",o):i.setAttributeNS(null,"onclick","objTrendGraph.showvaluepopup({show: true, x: "+t.x+", y: "+(t.y-8)+", value: '"+a.value+"', label: '"+a.label+"'})"),e.appendChild(i)}},createlabel:function(e,t,a,o){var n=this,r=document.createElementNS("http://www.w3.org/2000/svg","text");r.setAttributeNS(null,"x",t.x+""),r.setAttributeNS(null,"y",t.y+""),"y"==o&&n.props.labels.y.translate&&r.setAttributeNS(null,"transform","translate("+n.props.labels.y.translate.x+", "+n.props.labels.y.translate.y+")");var i=document.createTextNode(a.label);r.appendChild(i),e.appendChild(r)},setsvglinecoordinates:function(e,t){e.setAttributeNS(null,"x1",t.x1),isNaN(t.y1)&&console.trace(t.y1),e.setAttributeNS(null,"y1",t.y1),e.setAttributeNS(null,"x2",t.x2),e.setAttributeNS(null,"y2",t.y2)},updatelastpointingraph:function(e){var t=this;if(null!=t.vars.data){var a=t.getsvgcoordinatesforpointflex(e,t.vars.data.points[t.vars.data.points.length-1].utcend);t.el.lastsegment.setAttributeNS(null,"x2",a.x),t.el.lastsegment.setAttributeNS(null,"y2",a.y),t.el.lastpoint.setAttributeNS(null,"cx",a.x),t.el.lastpoint.setAttributeNS(null,"cy",a.y),t.el.lastpoint.setAttributeNS(null,"data-value",e),t.positiontrendpopupandsetvalue(a,e)}},positiontrendpopupandsetvalue:function(e,t){var a=this;e.y+a.vars.popuptrendheight>=a.props.height-a.props.padding.bottom?a.fliptrendpopup("flipped"):a.fliptrendpopup("original");var o=a.el.popuptrend.getAttributeNS(null,"transform").replace(/^.*\)\s+(.*)$/,"$1");app.state.ie?a.el.popuptrend.setAttributeNS(null,"transform","translate("+(e.x-a.vars.popuptrendwidth+18)+", "+(e.y+(a.state.trendpopupflipped?-10:10))+") "):a.el.popuptrend.setAttributeNS(null,"transform","translate("+(e.x-a.vars.popuptrendwidth+18)+", "+(e.y+(a.state.trendpopupflipped?-10:10))+") "+o),a.el.popuptrendnumber.textContent=a.correctlabeldecimals(t+"",a.props.axis.ymax+"")},showvaluepopup:function(e){var t=this;e.show?(t.el.popupvalue.setAttributeNS(null,"transform","translate("+(e.x-t.vars.popupvaluewidth/2)+", "+(e.y-t.vars.popupvalueheight)+")"),t.el.popupvalue.setAttributeNS(null,"visibility","visible"),t.el.popupvaluenumber.textContent=e.value+""):t.el.popupvalue.setAttributeNS(null,"visibility","hidden")},decimalplaces:function(e){var t=(""+e).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return t?Math.max(0,(t[1]?t[1].length:0)-(t[2]?+t[2]:0)):0},correctlabeldecimals:function(e,t){var a=!1,o=0;3==arguments.length&&(a=arguments[2]),t=t.replace(/,/,""),e=e.replace(/,/,""),t.indexOf(".")>-1&&(o=t.split(".")[1].length);var n=formatMoney(parseFloat(e),o,",",".","");return a&&n.indexOf(".")>-1&&(n=parseFloat(n).toFixed(n.split(".")[1].length-1)),n},fliptrendpopup:function(e){var t=this;"original"==e&&t.state.trendpopupflipped&&(t.el.popuptrendbase.removeAttributeNS(null,"transform"),t.el.popuptrendtextwrapper.removeAttributeNS(null,"transform"),t.state.trendpopupflipped=!1),"flipped"!=e||t.state.trendpopupflipped||(t.el.popuptrendbase.setAttributeNS(null,"transform","scale(1,-1)"),t.el.popuptrendtextwrapper.setAttributeNS(null,"transform","translate(0,-53)"),t.state.trendpopupflipped=!0)},reset:function(){var e=this,t=e.el.root.parentNode;t.removeChild(e.el.root),t.innerHTML=e.vars.template,e.init()},drawgraph:function(e){var t=this,a={},o={};e.points.sort(function(e,t){return e.utcend-t.utcend}),t.vars.data=e,t.props.axis.ylabelinset;var n=document.getElementById("graph_title");if(n.setAttributeNS(null,"x",t.props.padding.left+(t.props.axis.ylabelinset?0:2)),n.textContent=t.props.title.text,null==t.vars.data.ymax||null==t.vars.data.ymin){for(var r=-1e12,i=1e12,l=0;l<t.vars.data.points.length;l++)t.vars.data.points[l].value>r&&(r=t.vars.data.points[l].value),t.vars.data.points[l].value<i&&(i=t.vars.data.points[l].value);t.props.axis.ymin=i-1,t.props.axis.ymax=r+1}else t.props.axis.ymin=t.vars.data.ymin,t.props.axis.ymax=t.vars.data.ymax;t.el.root.setAttributeNS(null,"viewBox","0 0 "+t.props.width+" "+t.props.height),t.setsvglinecoordinates(document.getElementById("x_axisline"),{x1:t.props.padding.left,y1:t.props.height-t.props.padding.bottom,x2:t.props.width-t.props.padding.right,y2:t.props.height-t.props.padding.bottom}),t.setsvglinecoordinates(document.getElementById("y_axisline"),{x1:t.props.padding.left,y1:t.props.padding.top,x2:t.props.padding.left,y2:t.props.height-t.props.padding.bottom});for(var s=document.getElementById("data_point_wrapper"),l=0;l<t.vars.data.points.length;l++){a=t.vars.data.points[l],o=t.getsvgcoordinatesforpointflex(a.value,a.utcend);var d="";l==t.vars.data.points.length-1&&(d=t.props.line.lastpoint.id),t.createcoordinatepoint(s,o,a,d),l==t.vars.data.points.length-1&&t.positiontrendpopupandsetvalue(o,a.value)}for(var p=document.getElementById("line_wrapper"),l=0;l<t.vars.data.points.length;l++){var u={};if(l>0&&(u.x=o.x,u.y=o.y),a=t.vars.data.points[l],o=t.getsvgcoordinatesforpointflex(a.value,a.utcend),l>0){var w=document.createElementNS("http://www.w3.org/2000/svg","line");t.setsvglinecoordinates(w,{x1:u.x,y1:u.y,x2:o.x,y2:o.y}),l==t.vars.data.points.length-1&&(w.setAttributeNS(null,"class",t.props.line.lastsegment.class),w.setAttributeNS(null,"id",t.props.line.lastsegment.id)),l==t.vars.data.points.length-2&&(w.setAttributeNS(null,"class","current"),"undefined"!=typeof e.styles&&w.setAttributeNS(null,"style",e.styles.stylecurrentline)),p.appendChild(w)}}for(var c=document.getElementById("x_axislabel_wrapper"),l=0;l<t.vars.data.points.length;l++)if(a=t.vars.data.points[l],o=t.getsvgcoordinatesforpointflex(a.value,a.utcend),o.y=t.props.height-t.props.labels.x.padding.bottom,t.createlabel(c,o,a,"x"),t.props.axis.showxlines){var g=document.createElementNS("http://www.w3.org/2000/svg","line");t.setsvglinecoordinates(g,{x1:o.x,y1:t.props.padding.top+t.props.height-t.props.padding.top-t.props.padding.bottom,x2:o.x,y2:t.props.padding.top+t.props.height-t.props.padding.top-t.props.padding.bottom-t.props.axis.xlinelength}),c.appendChild(g)}var b=document.getElementById("y_axislabel_wrapper"),m=document.getElementById("grid_wrapper"),f=4,v=t.props.axis.ystep%1!==0,h=[];if(document.getElementById("wrapper").setAttributeNS(null,"class",t.props.axis.ylabelinset?"inset":"normal"),null==t.props.axis.ygridlines)for(var l=parseFloat(t.props.axis.ymin);l<=t.props.axis.ymax;l+=.1)l=Math.round(10*l)/10,l%t.props.axis.ystep==0&&h.push({value:l,label:v&&l%1===0?l+".0":l+"",utcend:t.vars.data.points[0].utcend});else{var y=t.decimalplaces(t.props.axis.ymax),j=1,x=1;(t.props.axis.ymax+"").length;switch(y){case 1:j=10,x=10;break;case 2:j=100,x=15;break;case 3:j=1e3,x=20;break;case 4:j=1e4,x=25}var S=(t.props.axis.ymax-t.props.axis.ymin)/100*x,_=Math.round((t.props.axis.ymax-S)*j)/j;h.push({value:_,label:t.correctlabeldecimals(_+"",t.props.axis.ymax+"",!0)});var E=Math.round((t.props.axis.ymin+S)*j)/j;h.push({value:E,label:t.correctlabeldecimals(E+"",t.props.axis.ymax+"",!0)});for(var P=(_-E)/(t.props.axis.ygridlines-1),l=2;l<t.props.axis.ygridlines;l++){var L=Math.round((E+P*(l-1))*j)/j;h.push({value:L,label:t.correctlabeldecimals(L+"",t.props.axis.ymax+"",!0),utcend:t.vars.data.points[0].utcend})}}for(var l=0;l<h.length;l++){if(a=h[l],o=t.getsvgcoordinatesforpointflex(a.value,a.utcend),o.x=t.props.padding.left+(t.props.axis.ylabelinset?3:-5),o.y=o.y+f,t.createlabel(b,o,a,"y"),o.y=o.y-f,o.x=t.props.padding.left,!t.props.axis.ylabelinset){var g=document.createElementNS("http://www.w3.org/2000/svg","line");t.setsvglinecoordinates(g,{x1:o.x,y1:o.y,x2:o.x+t.props.axis.ylinelength,y2:o.y}),b.appendChild(g)}var C=document.createElementNS("http://www.w3.org/2000/svg","line"),T=t.props.axis.ylabelinset?t.props.padding.left+t.props.axis.xpaddingleft-5:t.props.padding.left;t.props.axis.ygridlinesfullwidth&&(T=t.props.padding.left),t.setsvglinecoordinates(C,{x1:T,y1:o.y,x2:t.props.width-t.props.padding.right,y2:o.y}),m.appendChild(C)}t.el.lastsegment=document.getElementById(t.props.line.lastsegment.id),t.el.lastpoint=document.getElementById(t.props.line.lastpoint.id),"undefined"!=typeof objRegionInfo&&objRegionInfo.showhistory()},getbbox:function(){var e=this;try{0==e.vars.popuptrendwidth&&(e.el.toppanel.className="show",e.vars.popuptrendwidth=e.el.popuptrend.getBBox().width),0==e.vars.popuptrendheight&&(e.vars.popuptrendheight=e.el.popuptrend.getBBox().height),0==e.vars.popupvaluewidth&&(e.vars.popupvaluewidth=e.el.popupvalue.getBBox().width),0==e.vars.popupvalueheight&&(e.vars.popupvalueheight=e.el.popupvalue.getBBox().height),0==e.vars.popuptrendtextwrapperheight&&(e.vars.popuptrendtextwrapperheight=e.el.popuptrendtextwrapper.getBBox().height),0==e.vars.popuptrendwidth&&(e.el.toppanel.className="hide")}catch(e){console.trace()}},init:function(){var e=this;e.el.root=document.getElementById("graph"),e.el.popuptrend=document.getElementById("popup_trend"),e.el.popuptrendnumber=document.getElementById("popup_trend_number"),e.el.popupvalue=document.getElementById("popup_value"),e.el.popuptrendbase=document.getElementById("popup_trend_base"),e.el.popupvaluenumber=document.getElementById("popup_value_number"),e.el.popuptrendtextwrapper=document.getElementById("popup_trend_text_wrapper"),e.el.toppanel=getEl("top_panel"),isPublicSite()||e.getbbox();var t=new XMLSerializer;e.vars.template=t.serializeToString(e.el.root),e.state.trendpopupflipped=!1}},objLoading={state:{visible:null,tweening:null},vars:{animate:!1},el:{wrapper:null},show:function(e){var t=this;t.state.tweening=!0,t.el.wrapper&&(t.el.wrapper.style.display="block",(objOverlay.state.visible||0==objOverlay.state.visible&&1==objOverlay.state.tweening)&&0==objFilter.state.visible?objLoading.el.wrapper.style.background='url("./img/ajax-loader.gif") no-repeat':objLoading.el.wrapper.style.background='url("./img/ajax-loader_white.gif") no-repeat',app.state.ios?(t.el.wrapper.style.opacity=.7,t.state.visible=!0,t.state.tweening=!1,e&&e()):TweenLite.to(t.el.wrapper,.3,{opacity:.7,delay:0,onComplete:function(){t.state.visible=!0,t.state.tweening=!1,e&&e()}}))},hide:function(e){var t=this;t.state.tweening=!0,t.el.wrapper&&(app.state.ios?(t.el.wrapper.style.display="none",t.state.visible=!1,t.state.tweening=!1,e&&e()):TweenLite.to(t.el.wrapper,.3,{opacity:0,delay:0,onComplete:function(){t.el.wrapper.style.display="none",t.state.visible=!1,t.state.tweening=!1,e&&e()}}))},init:function(){var e=this;e.state.tweening=!1,e.state.visible=!1,e.el.wrapper=getEl("loading")}},objPanelInfo={state:{visible:null,tweening:null,contentloaded:!1},el:{wrapper:null,content:null},show:function(e){var t=this;t.getcontent(e,function(){t.state.tweening=!0,t.el.wrapper.style.display="block",TweenLite.to(t.el.wrapper,.3,{opacity:1,onComplete:function(){t.state.tweening=!1,t.state.visible=!0}})})},hide:function(){var e=this;e.state.tweening=!0,TweenLite.to(e.el.wrapper,.3,{opacity:0,onComplete:function(){e.el.wrapper.style.display="none",e.state.tweening=!1,e.state.visible=!1}})},getcontent:function(e,t){var a=this,o=e+"_intro.html";window.serverSideRequest({url:objConfig.urls.base+"/data/"+o+(location.href.indexOf("http")>-1?"?rnd="+Math.random():""),method:"get",debug:!1,callback:function(o,n){a.el.contentwrapper.className=e,a.el.content.innerHTML=n,t()}})},removelocalstorageitems:function(){window.objStore.removelocalstorageitem("seenAppIntro"),window.objStore.removelocalstorageitem("seenFilterIntro"),window.objStore.removelocalstorageitem("seenRegionInfoIntro"),location.reload()},init:function(){var e=this;e.state.visible=!1,e.state.tweening=!1,e.el.wrapper=window.getEl("panel_info_panel"),e.el.contentwrapper=window.getEl("content_wrapper"),e.el.content=window.getEl("panel_info_content")}},objMruFilter={state:{selectedmru:null,selectedsector:null,tweening:null},el:{mrufilter:null,tempmru:null},setmrufilterstate:function(){var e=this;e.state.selectedmru=objPageState.state.filter.mru,e.state.selectedsector=e.getmrufilteraxisarray(objPageState.state.filter.mru)[0].id,e.showlevel(e.state.selectedsector,e.state.selectedmru,!1)},getsectoridfromfilterhtml:function(){},getmrufilteraxisarray:function(e){var t="#filter_container #"+e,a=Sizzle(t)[0],o=[];if(a&&a.firstElementChild)for(o.push({id:a.id,name:a.firstElementChild.innerHTML});null!=a.parentNode&&"filter_list"!==a.parentNode.className;)a=a.parentNode,"li"==a.localName&&o.push({id:a.id,name:a.firstElementChild.innerHTML});else o.push({id:"philips",name:"Philips Group"});return o.reverse()},getsectorfrombreadcrumb:function(e){return e.indexOf("ealthcare")>-1?"PD0900":e.indexOf("ighting")>-1?"PD0100":e.indexOf("ifestyle")>-1||e.indexOf("ersonal")>-1?"PD0200":e.indexOf("onnected")>-1?"DHS003":e.indexOf("iagnosis")>-1?"DHS001":e.indexOf("oyal")>-1?"royalphilips":"philips"},getmrufilterbreadcrumb:function(){for(var e=this,t=e.getmrufilteraxisarray(objPageState.state.filter.mru),a=[],o=0;o<t.length;o++)a.push(t[o].name);return a.join(" &bull; ")},preparehtml:function(e){var t=this;t.el.tempmru.innerHTML=e,t.el.mrufilter=getEl("filter_container"),t.el.mrufilter.innerHTML=e,t.state.selectedsector=app.defaultpagestate.filter.sector},selectmru:function(e,t,a){var o=this;e&&e.stopPropagation(),o.showlevel(t,a)},showlevel:function(e,t){var a=this;a.state.selectedmru=t,a.state.selectedsector=e;for(var o=getEl(t),n=o.parentNode,r=getFirstLevelChildElements(n,"li"),i=getEl("filter_container").getElementsByTagName("li"),l=0;l<i.length;l++)i[l].className="";for(var s=0;s<r.length;s++){var d=r[s];if(d!=o)for(var p=d.getElementsByTagName("ul"),u=0;u<p.length;u++)2==arguments.length?TweenLite.to(p[u],.2,{height:0}):p[u].style.height="0px"}if(o.className="selected",2==arguments.length){var w=getFirstLevelChildElements(o,"ul");w.length>0&&TweenLite.to(w[0],.4,{height:"auto"})}else for(var c=a.getmrufilteraxisarray(objPageState.state.filter.mru),l=0;l<c.length;l++){var w=getFirstLevelChildElements(getEl(c[l].id),"ul");w.length>0&&(w[0].style.height="auto")}objHeader.setbreadcrumb(objMruFilter.getmrufilterbreadcrumb()),2==arguments.length&&objFilter.blink(),isPublicSite()&&objFilter.applyfilter()},init:function(e){var t=this;t.state.tweening=!1,t.state.selectedmru=app.defaultpagestate.filter.mru,t.state.selectedsector="philips",t.el.mrufilter=getEl("filter_container"),t.el.tempmru=getEl("producttree_temp")}},objOruFilter={json:null,state:{selectedoru:null,selectedoruguid:null},el:{mrufilter:null,wrapper:null},setorufilterstate:function(){var e=this;e.state.selectedoru=window.objPageState.state.filter.orulevel;var t="btn_country";switch(window.objPageState.state.filter.orulevel){case"1":t="btn_world";break;case"2":t="btn_region";break;case"3":t="btn_bmc"}e.selectoru(window.getEl(t),window.objPageState.state.filter.orulevel,!1)},getregionnamebyid:function(e){var t=window.objConfig.fragments[e];if(null==t){var a="";"cantral-east_europe"===e&&(a="central-east_europe"),"central-east_europe"===e&&(a="cantral-east_europe"),t=window.objConfig.fragments[e]}return window.returnObj={},t},selectoru:function(e,t){var a=this;a.el.wrapper=window.getEl("oru_filter_container"),e.className="selected",a.state.selectedoru=t,window.objHeader.setbreadcrumb(window.objMruFilter.getmrufilterbreadcrumb()),2===arguments.length&&window.objFilter.blink(),window.isPublicSite()&&window.objFilter.applyfilter()},settocurrentoru:function(){for(var e=this,t=e.el.wrapper.getElementsByTagName("option"),a=0;a<t.length;a++)t[a].getAttribute("value")===window.objPageState.state.filter.orulevel&&t[a].setAttribute("selected","selected")},setdatalevelattribute:function(e){window.getEl("body").setAttribute("data-orulevel","level"+(e?e:document.getElementsById("oru-select").selectedValue))},convertoruleveltomarket:function(e){switch(parseInt(e,10)){case 1:return"World";case 2:return"Region";case 3:return"Market";case 4:return"Country"}return""},init:function(e){var t=this;t.state.selectedoru=window.app.defaultpagestate.filter.orulevel,t.el.wrapper=window.getEl("oru_filter_container"),objOruFilter.setdatalevelattribute(1)}},objDataFilter={el:{wrapper:""},state:{filter:{datasource:"lives_improved",subtype:""},subtype:{}},init:function(){var e=this;e.el.wrapper=window.getEl("map-tab_panels");for(var t=window.Sizzle(".map-tab_panels > div > ul > li"),a=0;a<t.length;a++)t[a].addEventListener("click",this.datasourceChanged,!1)},showHideLegend:function(){"lives_improved"===objDataFilter.state.filter.datasource||"all"!==objDataFilter.state.filter.subtype?(window.objRegionInfo.renderLegend(),window.TweenLite.to(window.objRegionInfo.el.legend,.3,{opacity:1})):window.TweenLite.to(window.objRegionInfo.el.legend,.3,{opacity:0})},resetsubtypeindicators:function(e){for(var t=0;t<e.length;t++)e[t].innerText=objConfig.fragments.all_data},datasourceChanged:function(e){var t=this,a=!1;e.type&&"click"===e.type?(e.stopPropagation(),a=!0):t=e,objDataFilter.state.filter.datasource=t.getAttribute("data-panel"),objDataFilter.state.filter.subtype="all";for(var o=objDataFilter.el.wrapper.getElementsByClassName("active-tab"),n=0;n<o.length;n++)o[n].removeAttribute("class");t.setAttribute("class","active-tab"),objDataFilter.resetsubtypeindicators(objDataFilter.el.wrapper.getElementsByClassName("subtypeindicator")),window.getEl("body").removeAttribute("data-subtype"),a&&(window.objFilter.applyfilter(),objDataFilter.showHideLegend())},subtypeChanged:function(e){e&&e.stopPropagation(),objDataFilter.datasourceChanged(this.parentNode.parentNode.parentNode);var t=this.getAttribute("data-subtype");this.parentNode.parentNode.parentNode.getElementsByClassName("subtypeindicator")[0].innerHTML=this.innerText,window.getEl("body").setAttribute("data-subtype",t),objDataFilter.state.filter.subtype=t,window.objFilter.applyfilter(),objDataFilter.showHideLegend()}},app={state:{width:null,height:null,mobile:null,ios:!!navigator.userAgent.match(/(iPad|iPhone|iPod)/g),ios7:!!navigator.userAgent.match(/OS 7_/g),ipad:!!navigator.userAgent.match(/(iPad)/g),orientation:"",ie:!!window.MSStream,webbrowser:location.href.indexOf("http")>-1,initialmapview:!0,inframe:top===self},vars:{basehtml:null},defaultpagestate:{view:"worldmap",popup:"none",filter:{datasource:"lives_improved",orulevel:"3",oru:"none",sector:"philips",mru:"philips"}},labels:{simulatortitle:" simulation"},trendgraph:{predictionlabel:"Q1 2014",predictiondate:"2014-03-31",pointsvisible:null,stylecurrentline:""},el:{outerwrapper:null},btnfilterclick:function(e){window.objAnalytics.data.events.push({category:"button",action:"click",label:"open filter panel"}),window.objFilter.show()},btnbookmarksclick:function(e){window.objAnalytics.data.events.push({category:"button",action:"click",label:"open bookmarks panel"}),window.objBookmarks.show()},btnexplainclick:function(e){window.objAnalytics.data.events.push({category:"button",action:"click",label:"open help panel"}),window.objExplain.show()},btnlogoutclick:function(e){window.objAnalytics.data.events.push({category:"button",action:"click",label:"logout"}),window.objLogin.logout()},showtransparentlayer:function(){window.getEl("transparentlayer").style.display="block"},hidetransparentlayer:function(){window.getEl("transparentlayer").style.display="none"},isMobile:{any:function(){return"none"===window.getComputedStyle(window.getEl("map"),null).display}},retrievechartdata:function(e){var t={_type:"json",method:"getworldmapdata",token:window.objLogin.token,source:e,period:"future"};window.psv("GET",window.objConfig.urls.dynamicresourceurl,t,function(t,a){null!=t?window.objError.show("There was an error retrieving the worldmap data. "+("object"==typeof t?JSON.parse(t):t),!0):window.objData[e]=a})},retrievemetadata:function(){var e={fulldomain:location.protocol+"//"+location.hostname,method:"getoruandproductdata",type:"json",token:window.objLogin.token,snapshotid:window.objConfig.currentsnapshotid};window.psv("GET",window.objConfig.urls.dynamicresourceurl,e,app.retrievemetadatahandler)},retrievemetadatahandler:function(e,t){e||window.hasProperty(t,"error")?window.hasProperty(t,"error")?window.objError.show("There was an error retrieving metadata information. "+("object"==typeof t?JSON.stringify(t):t),!0):window.objError.show("There was an error retrieving metadata information. "+("object"==typeof e?JSON.stringify(e):e),!0):t.hasOwnProperty("authenticated")&&!t.authenticated?window.handleShibbolethLoginRequired():(window.objOruFilter.json=t.result.orudata,window.objMruFilter.preparehtml(t.result.productdata),app.retrievechartdata("sustainability"),app.retrievechartdata("global_presence"),app.processinitialview(!0))},start:function(e){window.objLogin.hide(),window.objMap.updatemap(e,app.showappintromessage)},showappintromessage:function(){var e=window.objStore.getlocalstorageitem("seenAppIntro");window.isPublicSite()?window.objStore.setlocalstorageitem("seenAppIntro","true"):e&&app.state.mobile||!app.state.mobile?window.objLogin.showupdatemessages():(window.objPanelInfo.show("app"),window.objStore.setlocalstorageitem("seenAppIntro","true"))},getdimensions:function(){var e=this;e.state.width=document.body.clientWidth,e.state.height=document.documentElement.clientHeight-.15*document.documentElement.clientHeight-250,e.state.width>e.state.height?e.state.orientation="landscape":e.state.orientation="portrait"},processinitialview:function(e){var t=this;if(location.hash.length>0){var a=window.objPageState.hash2object(location.hash);a.hasOwnProperty("error")?location.hash=window.objPageState.object2hash(t.defaultpagestate):e?window.objPageState.handlechange(a):location.hash.indexOf("!/login/")>-1||(window.objStore.setlocalstorageitem("stateremembered",JSON.stringify(a)),a.view="login",location.hash=window.objPageState.object2hash(a))}else if(null!==window.objStore.getlocalstorageitem("stateremembered"))try{var o=JSON.parse(window.objStore.getlocalstorageitem("stateremembered"));window.objStore.removelocalstorageitem("stateremembered"),location.hash=window.objPageState.object2hash(o)}catch(e){window.objStore.removelocalstorageitem("stateremembered"),location.hash=window.objPageState.object2hash(t.defaultpagestate)}else location.hash=window.objPageState.object2hash(t.defaultpagestate)},initobjects:function(){var e=this;e.getdimensions(),e.state.mobile=e.isMobile.any(),window.objStore.init(),window.objAnalytics.init(),window.objLogin.init(),window.objMap.init(),window.objFooter.init(),window.objHeader.init(),window.objOverlay.init(),window.objRegionInfo.init(),window.objError.init(),window.objFilter.init(),window.objBookmarks.init(),window.objExplain.init(),window.objLoading.init(),window.objPanelInfo.init(),window.objOruFilter.init(),window.objMruFilter.init(),window.objDataFilter.init(),e.state.ios&&(window.objZoomPanSettings.dragtimerdelay=800,window.objZoomPanSettings.touchtimerdelay=300,e.state.ios7&&(window.getEl("title_bar").style.height="65px",window.getEl("info").style.top="10px",window.getEl("btn_back").style.top="10px",window.getEl("toggle_favourite").style.top="10px")),app.el.outerwrapper.className=window.objConfig.sitetype,window.objLogin.getsnapshotconfig()},init:function(){var e=this;app.el.outerwrapper=window.getEl("content_outer_wrapper"),e.vars.basehtml=window.serverSideRequest({url:window.objConfig.urls.base+"/data/body_content.html?v="+Math.random(),method:"get",debug:!1});var t=location.href.replace(/^(.*)index.*$/,"$1")+"data/locale-"+window.objConfig.lang+("en"===window.objConfig.lang?"_US":"_CN")+".json";(window.location.href.indexOf("results.philips.com")>-1||window.location.href.indexOf("resultshub.com")>-1)&&(t="/publications/ar16/data/locale-"+window.objConfig.lang+("en"===window.objConfig.lang?"_US":"_CN")+".json"),window.psv("GET",t,{v:Math.random()},function(t,a){if(t)window.objError.show("There was an error retrieving translation fragments. "+("object"==typeof t?JSON.stringify(t):t),!0);else{for(var o in a)"string"==typeof o&&(window.objConfig.fragments[o]=a[o]);e.vars.basehtml=e.vars.basehtml.replace(/\[([a-zA-Z\d\s_-]*?)\]/g,function(e,t,a,o){return window.translateFragment(t)}),app.el.outerwrapper.innerHTML=e.vars.basehtml,e.initobjects()}})}},regValid=/^#\!\/(login|worldmap|detail?)\/((\w|\d|-)+)\/((\w|\d|-)+)\/((\w|\d|-)+)\/((\w|\d|-)+)\/(filter|faq|help|bookmark|none?)\/((\w|\d|-)+)\/((\w|\d|-)+?)$/g,objPageState={state:{view:null,popup:null,filter:{datasource:null,orulevel:null,oru:null,sector:null,mru:null}},stateremembered:{},vars:{processed:0},clonestateobject:function(){var e=this;return{view:e.state.view,popup:e.state.popup,filter:{orulevel:e.state.filter.orulevel,oru:e.state.filter.oru,sector:e.state.filter.sector,mru:e.state.filter.mru,datasource:objPageState.state.filter.datasource}}},setstateobject:function(e){var t=this;e.hasOwnProperty("view")&&(t.state.view=e.view),e.hasOwnProperty("popup")&&(t.state.popup=e.popup),e.hasOwnProperty("filter")&&(e.filter.hasOwnProperty("orulevel")&&(t.state.filter.orulevel=e.filter.orulevel),e.filter.hasOwnProperty("oru")&&(t.state.filter.oru=e.filter.oru),e.filter.hasOwnProperty("sector")&&(t.state.filter.sector=e.filter.sector),e.filter.hasOwnProperty("mru")&&(t.state.filter.mru=e.filter.mru),e.filter.hasOwnProperty("datasource")&&(t.state.filter.datasource=e.filter.datasource))},updatepagestate:function(e){var t=objPageState.clonestateobject();e.hasOwnProperty("view")&&(t.view=e.view),e.hasOwnProperty("popup")&&(t.popup=e.popup),e.hasOwnProperty("filter")&&(e.filter.hasOwnProperty("orulevel")&&(t.filter.orulevel=e.filter.orulevel),e.filter.hasOwnProperty("oru")&&(t.filter.oru=e.filter.oru),e.filter.hasOwnProperty("sector")&&(t.filter.sector=e.filter.sector),e.filter.hasOwnProperty("mru")&&(t.filter.mru=e.filter.mru),e.filter.hasOwnProperty("datasource")&&(t.filter.datasource=e.filter.datasource),e.filter.hasOwnProperty("subtype")&&(t.filter.subtype=e.filter.subtype)),location.hash=objPageState.object2hash(t),objPageState.vars.processed++},hash2object:function(e){return regValid.test(e)?{view:e.replace(regValid,"$1"),popup:e.replace(regValid,"$10"),filter:{orulevel:e.replace(regValid,"$2"),oru:e.replace(regValid,"$4"),sector:e.replace(regValid,"$6"),mru:e.replace(regValid,"$8"),datasource:e.replace(regValid,"$11"),subtype:e.replace(regValid,"$13")}}:{error:!0}},object2hash:function(e){return"#!/"+e.view+"/"+e.filter.orulevel+"/"+e.filter.oru+"/"+e.filter.sector+"/"+e.filter.mru+"/"+e.popup+"/"+e.filter.datasource+"/"+(e.filter.subtype?e.filter.subtype:"all")},handlechange:function(e){var t=this;window.objAnalytics.data.views.push({page:location.hash.substr(2),title:location.hash.replace(regValid,function(){if("login"===e.view)return"/login";if(null==window.objOruFilter.json)return"/nothing";for(var t="/"+arguments[1]+"/"+window.objOruFilter.convertoruleveltomarket(arguments[2]).toLowerCase()+"/"+arguments[4]+"/",a=window.objMruFilter.getmrufilteraxisarray(arguments[8]),o=[],n=0;n<a.length;n++)o.push(a[n].name.toLowerCase().replace(/[\s]/gi,"_").replace(/&amp;/,"and"));return t+=o.join("/")+"/"+arguments[10]})});var a=!1,o=!1,n=!1,r=!1,i=!1,l=!1,s=!1;if(t.state.filter.orulevel!==e.filter.orulevel&&(o=!0,a=!0),t.state.filter.oru!==e.filter.oru&&(n=!0,a=!0),t.state.filter.sector!==e.filter.sector&&(r=!0,a=!0),t.state.filter.mru!==e.filter.mru&&(i=!0,a=!0),t.state.filter.datasource===e.filter.datasource&&t.state.filter.subtype===e.filter.subtype||(l=!0,a=!0),"login"===t.state.view&&"login"!==e.view&&(s=!0),t.state.mobile&&t.state.initialmapview&&s&&"login"!==e.view&&app.showtransparentlayer(),t.state.view!==e.view)switch(e.view){case"worldmap":t.updateworldmapview(e,r,i,o,n,!1,l);break;case"login":t.stateremembered=t.clonestateobject(),t.setstateobject(e),window.objLogin.show();break;case"detail":t.updateworldmapview(e,r,i,o,n,!0,l)}else a&&("detail"===e.view?t.updateworldmapview(e,r,i,o,n,!0,l):t.updateworldmapview(e,r,i,o,n,!1,l));window.objOruFilter.setdatalevelattribute(objPageState.state.filter.orulevel),t.setstateobject(e)},updateworldmapview:function(e,t,a,o,n,r,i){var l=this;"object"!=typeof window.objMap.data||t||a||o||!n?(l.setstateobject(e),window.objOruFilter.settocurrentoru(),r?app.start(!0):app.start()):"detail"===e.view?(l.setstateobject(e),window.objMap.detailspanel()):(l.state.filter.datasource!==e.filter.datasource&&window.objMap.updatemap(!1,app.showappintromessage),window.objRegionInfo.hide(),window.objMap.hideSelectedCountries(),
window.objHeader.setregionname(window.objMap.state.mapname))},copyfilterattributes:function(e){self.state.filter.orulevel!==e.filter.orulevel&&(self.state.filter.orulevel=e.filter.orulevel),self.state.filter.oru!==e.filter.oru&&(self.state.filter.oru=e.filter.oru),self.state.filter.sector!==e.filter.sector&&(self.state.filter.sector=e.filter.sector),self.state.filter.mru!==e.filter.mru&&(self.state.filter.mru=e.filter.mru)},init:function(){}},objAnalytics={data:{views:[],events:[]},state:{enabled:location.href.indexOf("www.results.philips.com")===-1},asyncanalytics:function(){for(var e=this,t=0;t<e.data.views.length;t++)e.state.enabled&&window.ga("send","pageview",e.data.views[t]),t===e.data.views.length-1&&(e.data.views.length=0);for(var t=0;t<e.data.events.length;t++){if(e.data.events[t].hasOwnProperty("category")&&e.data.events[t].hasOwnProperty("action"))switch(Object.keys(e.data.events[t]).length){case 2:e.state.enabled&&window.ga("send","event",e.data.events[t].category,e.data.events[t].action);break;case 3:e.data.events[t].hasOwnProperty("label")&&e.state.enabled&&window.ga("send","event",e.data.events[t].category,e.data.events[t].action,e.data.events[t].label);break;case 4:e.data.events[t].hasOwnProperty("label")&&e.data.events[t].hasOwnProperty("value")&&e.state.enabled&&window.ga("send","event",e.data.events[t].category,e.data.events[t].action,e.data.events[t].label,e.data.events[t].value)}t===e.data.events.length-1&&(e.data.events.length=0)}window.setTimeout(function(){objAnalytics.asyncanalytics()},500)},init:function(){var e=this;if(e.state.enabled){!function(e,t,a,o,n,r,i){e.GoogleAnalyticsObject=n,e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},e[n].l=1*new Date,r=t.createElement(a),i=t.getElementsByTagName(a)[0],r.async=1,r.src=o,i.parentNode.insertBefore(r,i)}(window,document,"script",location.href.indexOf("http")>-1?"//www.google-analytics.com/analytics.js":"js/lib/analytics.js","ga");var t;t=location.href.indexOf("http")>-1?"auto":{storage:"none",clientId:window.objStore.getlocalstorageitem("statguid")},window.ga("create","UA-52778332-1",t),window.ga("set","forceSSL",!0),window.ga("send","pageview",{page:"/start"+(location.href.indexOf("http")>-1?"/website":"/app")}),e.asyncanalytics()}}};window.onresize=function(){app.getdimensions();try{app.isMobile.any()||(window.objMap.resizeworldmap(),window.objMap.centerworldmap(window.objMap.el.rootanimate),window.isPublicSite()&&window.objMap.maximizeworldmap(window.objMap.el.rootanimate),window.objRegionInfo.hide())}catch(e){}},window.onhashchange=function(){var e=objPageState.hash2object(location.hash);e.hasOwnProperty("error")?location.hash=objPageState.object2hash(app.defaultpagestate):objPageState.handlechange(e)},window.objData={};
//# sourceMappingURL=D:/sites/node-js/website_content/webapp/html/dist/js/maps/application.js.map
